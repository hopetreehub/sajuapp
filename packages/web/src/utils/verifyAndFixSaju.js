// 정확한 사주 계산을 위한 검증 및 수정

const SIXTY_CYCLE = [
  '갑자', '을축', '병인', '정묘', '무진', '기사', '경오', '신미', '임신', '계유',  // 0-9
  '갑술', '을해', '병자', '정축', '무인', '기묘', '경진', '신사', '임오', '계미',  // 10-19
  '갑신', '을유', '병술', '정해', '무자', '기축', '경인', '신묘', '임진', '계사',  // 20-29
  '갑오', '을미', '병신', '정유', '무술', '기해', '경자', '신축', '임인', '계묘',  // 30-39
  '갑진', '을사', '병오', '정미', '무신', '기유', '경술', '신해', '임자', '계축',  // 40-49
  '갑인', '을묘', '병진', '정사', '무오', '기미', '경신', '신유', '임술', '계해'   // 50-59
];

// 정확한 결과
const CORRECT_RESULTS = {
  '1971-11-17': {
    year: '신해',
    month: '기해',  // 기해가 정답 (경자가 아님)
    day: '병오',
    hour: '경인'
  },
  '1995-09-02': {
    year: '을해',
    month: '갑신',  // 갑신이 정답 (을유가 아님)
    day: '병신',
    hour: '경인'
  }
};

// 년간별 월간 규칙 (정확한 버전)
// 년간이 신(辛)일 때의 월간 순서
const YEAR_STEM_TO_MONTH_STEM_CORRECT = {
  '갑': ['병', '정', '무', '기', '경', '신', '임', '계', '갑', '을', '병', '정'],
  '기': ['병', '정', '무', '기', '경', '신', '임', '계', '갑', '을', '병', '정'],
  
  '을': ['무', '기', '경', '신', '임', '계', '갑', '을', '병', '정', '무', '기'],
  '경': ['무', '기', '경', '신', '임', '계', '갑', '을', '병', '정', '무', '기'],
  
  '병': ['경', '신', '임', '계', '갑', '을', '병', '정', '무', '기', '경', '신'],
  '신': ['경', '신', '임', '계', '갑', '을', '병', '정', '무', '기', '경', '신'],
  
  '정': ['임', '계', '갑', '을', '병', '정', '무', '기', '경', '신', '임', '계'],
  '임': ['임', '계', '갑', '을', '병', '정', '무', '기', '경', '신', '임', '계'],
  
  '무': ['갑', '을', '병', '정', '무', '기', '경', '신', '임', '계', '갑', '을'],
  '계': ['갑', '을', '병', '정', '무', '기', '경', '신', '임', '계', '갑', '을']
};

// 1971년 11월 17일 분석
console.log('=== 1971년 11월 17일 분석 ===');
console.log('정답: 신해 기해 병오 경인');
console.log('');

// 년주: 신해 (1971년)
// 1984년이 갑자년(0)이므로, 1971년은?
// 1971 - 1984 = -13
// (-13 % 60 + 60) % 60 = 47 
// SIXTY_CYCLE[47] = '신해' ✓

// 월주: 기해
// 신년의 11월(해월)은?
// 신년: ['경', '신', '임', '계', '갑', '을', '병', '정', '무', '기', '경', '신']
// 해월은 10번째(0-based index 9) = '기'
// 기해 ✓

console.log('1995년 9월 2일 분석');
console.log('정답: 을해 갑신 병신 경인');
console.log('');

// 년주: 을해 (1995년)
// 1995 - 1984 = 11
// SIXTY_CYCLE[11] = '을해' ✓

// 월주: 갑신
// 을년의 7월(신월, 9월은 백로 전이므로 신월)은?
// 을년: ['무', '기', '경', '신', '임', '계', '갑', '을', '병', '정', '무', '기']
// 신월은 7번째(0-based index 6) = '갑'
// 갑신 ✓

console.log('\n=== 수정된 월간 계산 규칙 ===');
console.log('문제점 발견:');
console.log('1. 1971년 11월 → 해월(10월) → 년간이 신(辛) → 월간은 기(己)');
console.log('2. 1995년 9월2일 → 신월(7월) → 년간이 을(乙) → 월간은 갑(甲)');

// 정확한 계산을 위한 수정된 함수
function calculateMonthPillarFixed(year, month, day, yearPillar) {
  const yearStem = yearPillar[0];
  
  // 절기월 계산 (더 정확한 버전)
  let solarMonth;
  
  // 2월 4일 입춘, 3월 6일 경칩, 4월 5일 청명, 5월 6일 입하
  // 6월 6일 망종, 7월 7일 소서, 8월 8일 입추, 9월 8일 백로
  // 10월 8일 한로, 11월 7일 입동, 12월 7일 대설, 1월 6일 소한
  
  if (month === 1) {
    solarMonth = day >= 6 ? 12 : 11; // 소한 이후면 축월, 이전이면 자월
  } else if (month === 2) {
    solarMonth = day >= 4 ? 1 : 12; // 입춘 이후면 인월
  } else if (month === 3) {
    solarMonth = day >= 6 ? 2 : 1; // 경칩 이후면 묘월
  } else if (month === 4) {
    solarMonth = day >= 5 ? 3 : 2; // 청명 이후면 진월
  } else if (month === 5) {
    solarMonth = day >= 6 ? 4 : 3; // 입하 이후면 사월
  } else if (month === 6) {
    solarMonth = day >= 6 ? 5 : 4; // 망종 이후면 오월
  } else if (month === 7) {
    solarMonth = day >= 7 ? 6 : 5; // 소서 이후면 미월
  } else if (month === 8) {
    solarMonth = day >= 8 ? 7 : 6; // 입추 이후면 신월
  } else if (month === 9) {
    solarMonth = day >= 8 ? 8 : 7; // 백로 이후면 유월, 이전이면 신월
  } else if (month === 10) {
    solarMonth = day >= 8 ? 9 : 8; // 한로 이후면 술월
  } else if (month === 11) {
    solarMonth = day >= 7 ? 10 : 9; // 입동 이후면 해월
  } else if (month === 12) {
    solarMonth = day >= 7 ? 11 : 10; // 대설 이후면 자월
  }
  
  // 월간 테이블 수정
  const monthStemTable = {
    '갑': ['병', '정', '무', '기', '경', '신', '임', '계', '갑', '을', '병', '정'],
    '기': ['병', '정', '무', '기', '경', '신', '임', '계', '갑', '을', '병', '정'],
    '을': ['무', '기', '경', '신', '임', '계', '갑', '을', '병', '정', '무', '기'],
    '경': ['무', '기', '경', '신', '임', '계', '갑', '을', '병', '정', '무', '기'],
    '병': ['경', '신', '임', '계', '갑', '을', '병', '정', '무', '기', '경', '신'],
    '신': ['경', '신', '임', '계', '갑', '을', '병', '정', '무', '기', '경', '신'],
    '정': ['임', '계', '갑', '을', '병', '정', '무', '기', '경', '신', '임', '계'],
    '임': ['임', '계', '갑', '을', '병', '정', '무', '기', '경', '신', '임', '계'],
    '무': ['갑', '을', '병', '정', '무', '기', '경', '신', '임', '계', '갑', '을'],
    '계': ['갑', '을', '병', '정', '무', '기', '경', '신', '임', '계', '갑', '을']
  };
  
  const monthStemArray = monthStemTable[yearStem];
  const monthStem = monthStemArray[solarMonth - 1];
  
  const monthBranches = ['인', '묘', '진', '사', '오', '미', '신', '유', '술', '해', '자', '축'];
  const monthBranch = monthBranches[solarMonth - 1];
  
  return monthStem + monthBranch;
}

// 테스트
console.log('\n=== 수정된 계산 결과 ===');

// 1971년 11월 17일
const yearPillar1 = '신해';
const month1 = calculateMonthPillarFixed(1971, 11, 17, yearPillar1);
console.log(`1971.11.17: 월주 = ${month1} (정답: 기해)`);
console.log(`월주 일치: ${month1 === '기해' ? '✓' : '✗'}`);

// 1995년 9월 2일
const yearPillar2 = '을해';
const month2 = calculateMonthPillarFixed(1995, 9, 2, yearPillar2);
console.log(`1995.09.02: 월주 = ${month2} (정답: 갑신)`);
console.log(`월주 일치: ${month2 === '갑신' ? '✓' : '✗'}`);