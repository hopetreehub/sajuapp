import{r as e,j as r,e as a}from"./react-vendor-BqNk2DgB.js";import{c as t,a as s}from"./customerApi-JV4xNEmH.js";function l({isOpen:a,onClose:s,onCustomerAdded:l}){const[d,n]=e.useState({name:"",birth_date:"",birth_time:"",phone:"",lunar_solar:"solar",gender:"male",memo:""}),[o,i]=e.useState({}),[c,x]=e.useState(!1),[m,u]=e.useState(null),b=e.useCallback(()=>{c||(g(),s())},[c,s]);e.useEffect(()=>{a&&g()},[a]),e.useEffect(()=>{const e=e=>{"Escape"===e.key&&a&&b()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[a,b]);const g=()=>{n({name:"",birth_date:"",birth_time:"",phone:"",lunar_solar:"solar",gender:"male",memo:""}),i({}),u(null)},h=(e,r)=>{"phone"===e&&(r=(e=>{const r=e.replace(/[^\d]/g,"");return r.length<=3?r:r.length<=7?`${r.slice(0,3)}-${r.slice(3)}`:`${r.slice(0,3)}-${r.slice(3,7)}-${r.slice(7,11)}`})(r)),n(a=>({...a,[e]:r})),o[e]&&i(r=>({...r,[e]:void 0})),m&&u(null)};return a?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&b()},role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto transform transition-all duration-300 scale-100",children:[r.jsx("div",{className:"sticky top-0 bg-white dark:bg-gray-800 px-6 py-4 border-b border-gray-200 dark:border-gray-700 rounded-t-2xl",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("h2",{id:"modal-title",className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[r.jsx("span",{className:"text-2xl",children:"👤"}),"새 고객 등록"]}),r.jsx("button",{onClick:b,disabled:c,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors disabled:opacity-50","aria-label":"모달 닫기",children:r.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),r.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};if(d.name.trim()?d.name.length<2&&(e.name="이름은 2자 이상 입력해주세요"):e.name="이름을 입력해주세요",d.birth_date){const r=new Date(d.birth_date),a=new Date,t=new Date(1900,0,1);r>a?e.birth_date="미래 날짜는 선택할 수 없습니다":r<t&&(e.birth_date="1900년 이후 날짜를 선택해주세요")}else e.birth_date="생년월일을 선택해주세요";d.birth_time||(e.birth_time="생시를 선택해주세요"),d.phone.trim()?/^010-\d{4}-\d{4}$/.test(d.phone)||(e.phone="올바른 전화번호 형식이 아닙니다 (예: 010-1234-5678)"):e.phone="전화번호를 입력해주세요";return i(e),0===Object.keys(e).length})()){x(!0),u(null);try{const e={name:d.name.trim(),birth_date:d.birth_date,birth_time:d.birth_time,phone:d.phone,lunar_solar:d.lunar_solar,gender:d.gender,memo:d.memo.trim()},r=await t(e);u({type:"success",text:"고객이 성공적으로 등록되었습니다!"}),setTimeout(()=>{l(r.data),b()},500)}catch(r){u({type:"error",text:r instanceof Error?r.message:"고객 등록 중 오류가 발생했습니다"})}finally{x(!1)}}},className:"p-6",children:[r.jsxs("div",{className:"space-y-5",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:[r.jsx("span",{className:"text-red-500",children:"*"})," 이름"]}),r.jsx("input",{type:"text",value:d.name,onChange:e=>h("name",e.target.value),className:`w-full px-4 py-3 border rounded-xl transition-colors\n                  ${o.name?"border-red-500 focus:ring-red-500":"border-gray-300 dark:border-gray-600 focus:ring-blue-500"}\n                  dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2`,placeholder:"고객 이름을 입력하세요",disabled:c,autoComplete:"name"}),o.name&&r.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:o.name})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:[r.jsx("span",{className:"text-red-500",children:"*"})," 생년월일"]}),r.jsx("input",{type:"date",value:d.birth_date,onChange:e=>h("birth_date",e.target.value),max:(new Date).toISOString().split("T")[0],min:"1900-01-01",className:`w-full px-4 py-3 border rounded-xl transition-colors\n                  ${o.birth_date?"border-red-500 focus:ring-red-500":"border-gray-300 dark:border-gray-600 focus:ring-blue-500"}\n                  dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2`,disabled:c}),o.birth_date&&r.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:o.birth_date})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:[r.jsx("span",{className:"text-red-500",children:"*"})," 생시 (24시간 형식)"]}),r.jsx("input",{type:"time",value:d.birth_time,onChange:e=>h("birth_time",e.target.value),className:`w-full px-4 py-3 border rounded-xl transition-colors\n                  ${o.birth_time?"border-red-500 focus:ring-red-500":"border-gray-300 dark:border-gray-600 focus:ring-blue-500"}\n                  dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2`,disabled:c}),o.birth_time&&r.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:o.birth_time})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:[r.jsx("span",{className:"text-red-500",children:"*"})," 전화번호"]}),r.jsx("input",{type:"tel",value:d.phone,onChange:e=>h("phone",e.target.value),className:`w-full px-4 py-3 border rounded-xl transition-colors\n                  ${o.phone?"border-red-500 focus:ring-red-500":"border-gray-300 dark:border-gray-600 focus:ring-blue-500"}\n                  dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2`,placeholder:"010-1234-5678",disabled:c,autoComplete:"tel"}),o.phone&&r.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:o.phone})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-3 text-gray-700 dark:text-gray-300",children:"음력/양력"}),r.jsxs("div",{className:"flex gap-6",children:[r.jsxs("label",{className:"flex items-center cursor-pointer",children:[r.jsx("input",{type:"radio",value:"solar",checked:"solar"===d.lunar_solar,onChange:()=>h("lunar_solar","solar"),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500",disabled:c}),r.jsx("span",{className:"ml-2 text-gray-700 dark:text-gray-300",children:"🌞 양력"})]}),r.jsxs("label",{className:"flex items-center cursor-pointer",children:[r.jsx("input",{type:"radio",value:"lunar",checked:"lunar"===d.lunar_solar,onChange:()=>h("lunar_solar","lunar"),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500",disabled:c}),r.jsx("span",{className:"ml-2 text-gray-700 dark:text-gray-300",children:"🌙 음력"})]})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium mb-3 text-gray-700 dark:text-gray-300",children:[r.jsx("span",{className:"text-red-500",children:"*"})," 성별"]}),r.jsxs("div",{className:"flex gap-6",children:[r.jsxs("label",{className:"flex items-center cursor-pointer",children:[r.jsx("input",{type:"radio",value:"male",checked:"male"===d.gender,onChange:()=>h("gender","male"),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500",disabled:c}),r.jsx("span",{className:"ml-2 text-gray-700 dark:text-gray-300",children:"👨 남성"})]}),r.jsxs("label",{className:"flex items-center cursor-pointer",children:[r.jsx("input",{type:"radio",value:"female",checked:"female"===d.gender,onChange:()=>h("gender","female"),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500",disabled:c}),r.jsx("span",{className:"ml-2 text-gray-700 dark:text-gray-300",children:"👩 여성"})]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"메모"}),r.jsx("textarea",{value:d.memo,onChange:e=>h("memo",e.target.value),rows:3,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl\n                         dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors resize-none",placeholder:"고객에 대한 추가 정보를 입력하세요 (선택사항)",disabled:c})]}),m&&r.jsx("div",{className:"p-4 rounded-xl text-sm font-medium "+("success"===m.type?"bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-300 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300 border border-red-200 dark:border-red-800"),children:r.jsxs("div",{className:"flex items-center gap-2",children:["success"===m.type?r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),m.text]})})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[r.jsx("button",{type:"button",onClick:b,disabled:c,className:"px-6 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300\n                       rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"취소"}),r.jsx("button",{type:"submit",disabled:c,className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl\n                       hover:from-blue-700 hover:to-blue-800 transition-all duration-200\n                       disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 font-medium",children:c?r.jsxs(r.Fragment,{children:[r.jsx("svg",{className:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})}),"등록 중..."]}):r.jsxs(r.Fragment,{children:[r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"등록하기"]})})]})]})]})}):null}function d({onSelect:t,selectedCustomer:d,showAddButton:n=!0}){a();const[o,i]=e.useState([]),[c,x]=e.useState(!1),[m,u]=e.useState(""),[b,g]=e.useState(!1),[h,y]=e.useState(!1),p=e.useCallback(async()=>{try{g(!0);const e=await s(1,100,m);i(e.data)}catch(e){}finally{g(!1)}},[m]);e.useEffect(()=>{p()},[p]);return!b&&o.length,r.jsxs("div",{className:"relative",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"고객 선택:"}),d?r.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-blue-50 dark:bg-blue-900/30 rounded-lg",children:[r.jsxs("span",{className:"text-blue-700 dark:text-blue-300",children:["👤 ",d.name," (",d.birth_date,")"]}),r.jsx("button",{onClick:()=>{t(null),u("")},className:"text-red-500 hover:text-red-700",children:"✕"})]}):r.jsx("button",{onClick:()=>x(!c),className:"px-4 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 \n                     rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:"👤 고객 선택하기"})]}),c&&r.jsxs("div",{className:"absolute top-full mt-2 w-96 bg-white dark:bg-gray-800 rounded-lg shadow-xl \n                      border border-gray-200 dark:border-gray-700 z-50",children:[r.jsxs("div",{className:"p-4 space-y-3",children:[n&&r.jsx("button",{onClick:()=>{y(!0),x(!1)},className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg\n                         flex items-center justify-center gap-2 transition-colors",children:"➕ 새 고객 등록"}),n&&r.jsx("div",{className:"border-t border-gray-200 dark:border-gray-600"}),r.jsx("input",{type:"text",placeholder:"이름 또는 전화번호로 검색...",value:m,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg\n                       bg-white dark:bg-gray-700 text-gray-900 dark:text-white",autoFocus:!0})]}),r.jsx("div",{className:"max-h-96 overflow-y-auto",children:b?r.jsx("div",{className:"p-4 text-center text-gray-500",children:"로딩 중..."}):0===o.length?r.jsxs("div",{className:"p-6 text-center space-y-4",children:[r.jsx("div",{className:"text-4xl",children:"🔮"}),r.jsxs("div",{className:"text-gray-600 dark:text-gray-400",children:[r.jsx("p",{className:"font-medium mb-2",children:"등록된 고객이 없습니다"}),r.jsxs("p",{className:"text-sm",children:['위의 "새 고객 등록" 버튼을 클릭하여',r.jsx("br",{}),"첫 고객을 등록해보세요"]})]})]}):r.jsx("div",{className:"divide-y dark:divide-gray-700",children:o.map(e=>r.jsx("button",{onClick:()=>(e=>{t(e),x(!1),u("")})(e),className:"w-full px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700\n                             transition-colors text-left",children:r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),r.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.birth_date," ",e.birth_time," ·","lunar"===e.lunar_solar?"음력":"양력"," ·","male"===e.gender?"남":"여"]})]}),r.jsx("div",{className:"text-sm text-gray-400",children:e.phone})]})},e.id))})}),r.jsx("div",{className:"p-2 border-t dark:border-gray-700",children:r.jsx("button",{onClick:()=>x(!1),className:"w-full px-3 py-2 text-gray-600 dark:text-gray-400 \n                       hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"닫기"})})]}),r.jsx(l,{isOpen:h,onClose:()=>y(!1),onCustomerAdded:e=>{p(),t(e),y(!1)}})]})}export{d as C};
