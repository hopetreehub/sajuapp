import{e,r,j as a}from"./react-vendor-BqNk2DgB.js";import{u as t}from"./index-DlHBBt9Z.js";import"./vendor-DgwlXjR1.js";import"./three-vendor-B4pyqsGd.js";import"./chart-vendor-DwU5C6A5.js";import"./document-vendor-kJlPqfgG.js";import"./calendar-vendor-Bhba01pF.js";const s=()=>{const{user:s,token:d}=t(),l=e(),[n,i]=r.useState([]),[o,c]=r.useState(!0),[x,g]=r.useState(null),[h,p]=r.useState("all"),[m,u]=r.useState(""),[y,b]=r.useState(null),[j,k]=r.useState(""),[v,w]=r.useState(!1);r.useEffect(()=>{(!s||"admin"!==s.role&&"super_admin"!==s.role)&&l("/dashboard")},[s,l]);const f=async()=>{if(d){c(!0),g(null);try{const e=new URLSearchParams;"all"!==h&&e.append("approval_status",h),m&&e.append("search",m);const r=await fetch(`/api/admin/users?${e}`,{headers:{Authorization:`Bearer ${d}`}}),a=await r.json();if(!r.ok)throw new Error(a.success?"사용자 목록을 불러올 수 없습니다.":"권한이 없습니다.");i(a.users)}catch(e){g(e.message)}finally{c(!1)}}};r.useEffect(()=>{f()},[h,m,d]);const N=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";case"approved":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"rejected":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";case"suspended":return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200";default:return"bg-gray-100 text-gray-800"}},S=e=>{switch(e){case"pending":return"승인 대기";case"approved":return"승인됨";case"rejected":return"거부됨";case"suspended":return"정지됨";default:return e}};return o&&0===n.length?a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-purple-600 border-t-transparent rounded-full"})}):a.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8 px-4",children:[a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"사용자 관리"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"회원 승인, 거부, 정지 및 역할 관리"})]}),a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-6",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"상태 필터"}),a.jsxs("select",{value:h,onChange:e=>p(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[a.jsx("option",{value:"all",children:"전체"}),a.jsx("option",{value:"pending",children:"승인 대기"}),a.jsx("option",{value:"approved",children:"승인됨"}),a.jsx("option",{value:"rejected",children:"거부됨"}),a.jsx("option",{value:"suspended",children:"정지됨"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"검색 (이메일/이름)"}),a.jsx("input",{type:"text",value:m,onChange:e=>u(e.target.value),placeholder:"검색어 입력...",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]})}),x&&a.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-lg p-4 mb-6",children:a.jsx("p",{className:"text-red-700 dark:text-red-400",children:x})}),a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"사용자"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"역할"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"상태"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"가입일"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"액션"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:0===n.length?a.jsx("tr",{children:a.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-gray-500 dark:text-gray-400",children:"사용자가 없습니다."})}):n.map(e=>a.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[a.jsxs("td",{className:"px-6 py-4",children:[a.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.username}),a.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.email})]}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("select",{value:e.role,onChange:r=>(async(e,r)=>{if(d&&confirm(`역할을 ${r}(으)로 변경하시겠습니까?`))try{const a=await fetch(`/api/admin/users/${e}/role`,{method:"PATCH",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify({role:r})}),t=await a.json();if(!a.ok)throw new Error(t.error||"역할 변경에 실패했습니다.");alert("역할이 변경되었습니다."),f()}catch(a){alert(a.message)}})(e.id,r.target.value),className:"text-sm px-2 py-1 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white",disabled:e.id===(null==s?void 0:s.id),children:[a.jsx("option",{value:"user",children:"일반 사용자"}),a.jsx("option",{value:"admin",children:"관리자"}),a.jsx("option",{value:"super_admin",children:"슈퍼 관리자"})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${N(e.approval_status)}`,children:S(e.approval_status)})}),a.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-400",children:new Date(e.created_at).toLocaleDateString("ko-KR")}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex space-x-2",children:["pending"===e.approval_status&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>(async e=>{if(d&&confirm("이 사용자를 승인하시겠습니까?"))try{const r=await fetch(`/api/admin/users/${e}/approve`,{method:"POST",headers:{Authorization:`Bearer ${d}`}}),a=await r.json();if(!r.ok)throw new Error(a.error||"승인에 실패했습니다.");alert("사용자가 승인되었습니다."),f()}catch(r){alert(r.message)}})(e.id),className:"px-3 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700",children:"승인"}),a.jsx("button",{onClick:()=>(e=>{b(e),k(""),w(!0)})(e),className:"px-3 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700",children:"거부"})]}),"approved"===e.approval_status&&"admin"!==e.role&&"super_admin"!==e.role&&a.jsx("button",{onClick:()=>(async e=>{if(d&&confirm("이 사용자를 정지하시겠습니까?"))try{const r=await fetch(`/api/admin/users/${e}/suspend`,{method:"POST",headers:{Authorization:`Bearer ${d}`}}),a=await r.json();if(!r.ok)throw new Error(a.error||"정지에 실패했습니다.");alert("사용자가 정지되었습니다."),f()}catch(r){alert(r.message)}})(e.id),className:"px-3 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700",children:"정지"})]})})]},e.id))})]})})})]}),v&&y&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"사용자 거부"}),a.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:[y.username,"(",y.email,")의 가입을 거부하는 이유를 입력해주세요."]}),a.jsx("textarea",{value:j,onChange:e=>k(e.target.value),placeholder:"거부 사유를 입력하세요...",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white mb-4",rows:4}),a.jsxs("div",{className:"flex justify-end space-x-3",children:[a.jsx("button",{onClick:()=>{w(!1),b(null)},className:"px-4 py-2 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"취소"}),a.jsx("button",{onClick:async()=>{if(d&&y&&j.trim())try{const e=await fetch(`/api/admin/users/${y.id}/reject`,{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify({reason:j})}),r=await e.json();if(!e.ok)throw new Error(r.error||"거부에 실패했습니다.");alert("사용자가 거부되었습니다."),w(!1),b(null),f()}catch(e){alert(e.message)}else alert("거부 사유를 입력해주세요.")},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"거부하기"})]})]})})]})};export{s as default};
