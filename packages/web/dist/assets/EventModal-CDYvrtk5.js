import{j as e,r as t}from"./react-vendor-BqNk2DgB.js";import{t as r,a,e as o}from"./index-DlHBBt9Z.js";import{c as s}from"./qimenCalculator-Dgq1wFxg.js";import{p as l,f as n,j as i}from"./calendar-vendor-Bhba01pF.js";const d=({tag:t,onDelete:r,onClick:a,size:o="medium",deletable:s=!1})=>e.jsxs("span",{className:`\n        inline-flex items-center gap-1 rounded-full font-medium\n        ${{small:"text-xs px-2 py-0.5",medium:"text-sm px-3 py-1",large:"text-base px-4 py-2"}[o]}\n        ${a?"cursor-pointer hover:opacity-80":""}\n        transition-opacity\n      `,style:{backgroundColor:`${t.color}20`,color:t.color,border:`1px solid ${t.color}40`},onClick:a,children:[e.jsx("span",{children:t.name}),s&&r&&e.jsx("button",{className:"ml-1 hover:opacity-60 focus:outline-none",onClick:e=>{e.stopPropagation(),null==r||r()},"aria-label":`Remove ${t.name} tag`,children:e.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),c=({selectedTags:a,onTagsChange:o,placeholder:s="태그를 선택하세요",allowCreate:l=!0})=>{const[n,i]=t.useState([]),[c,m]=t.useState(!1),[u,x]=t.useState(""),[g,b]=t.useState(!1),[p,f]=t.useState(!1),[h,y]=t.useState(""),[v,j]=t.useState("#3B82F6");t.useEffect(()=>{N()},[]);const N=async()=>{try{b(!0);const e=await r.getTags();i(e)}catch(e){}finally{b(!1)}},k=e=>{a.find(t=>t.id===e.id)||o([...a,e]),m(!1),x("")},w=n.filter(e=>e.name.toLowerCase().includes(u.toLowerCase())&&!a.find(t=>t.id===e.id));return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:a.map(t=>e.jsx(d,{tag:t,size:"small",deletable:!0,onDelete:()=>{return e=t.id,void o(a.filter(t=>t.id!==e));var e}},t.id))}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",className:"w-full px-3 py-2 text-left border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:()=>m(!c),children:e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:a.length>0?`${a.length}개 태그 선택됨`:s})}),c&&e.jsxs("div",{className:"absolute z-50 w-full mt-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg",children:[e.jsx("div",{className:"p-2 border-b border-gray-200 dark:border-gray-700",children:e.jsx("input",{type:"text",className:"w-full px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-900 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"태그 검색...",value:u,onChange:e=>x(e.target.value),onClick:e=>e.stopPropagation()})}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:g?e.jsx("div",{className:"p-3 text-center text-gray-500",children:"로딩 중..."}):w.length>0?w.map(t=>e.jsxs("button",{type:"button",className:"w-full px-3 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",onClick:()=>k(t),children:[e.jsx("span",{className:"w-4 h-4 rounded-full",style:{backgroundColor:t.color}}),e.jsx("span",{className:"text-sm",children:t.name})]},t.id)):e.jsx("div",{className:"p-3 text-center text-gray-500 text-sm",children:u?"일치하는 태그가 없습니다":"사용 가능한 태그가 없습니다"})}),l&&e.jsxs("div",{className:"p-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"text",className:"flex-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-900 focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"새 태그 이름",value:h,onChange:e=>y(e.target.value),onClick:e=>e.stopPropagation()}),e.jsx("div",{className:"flex gap-1",children:["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#6B7280","#F97316"].map(t=>e.jsx("button",{type:"button",className:"w-6 h-6 rounded-full border-2 "+(v===t?"border-gray-800 dark:border-gray-200":"border-transparent"),style:{backgroundColor:t},onClick:()=>j(t)},t))})]}),e.jsx("button",{type:"button",className:"w-full px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",onClick:async()=>{if(h.trim())try{f(!0);const e=await r.createTag({name:h.trim(),color:v});i([...n,e]),k(e),y(""),j("#3B82F6")}catch(e){}finally{f(!1)}},disabled:!h.trim()||p,children:p?"생성 중...":"새 태그 만들기"})]})]})]})]})};function m(e,t,r=60){const a=[];let o=new Date(e);for(;o<=t;){const e=s({dateTime:o});a.push({time:new Date(o),score:e.overallFortune.score,fortune:e.overallFortune.level,chart:e}),o=l(o,r)}return a}function u(e){return{excellent:"🌟",good:"✨",neutral:"⚖️",bad:"⚠️",terrible:"❌"}[e]}function x(e){return{excellent:"text-green-500",good:"text-blue-500",neutral:"text-gray-500",bad:"text-orange-500",terrible:"text-red-500"}[e]}function g(e){return{excellent:"bg-green-100 dark:bg-green-900",good:"bg-blue-100 dark:bg-blue-900",neutral:"bg-gray-100 dark:bg-gray-900",bad:"bg-orange-100 dark:bg-orange-900",terrible:"bg-red-100 dark:bg-red-900"}[e]}function b(e,t){const r=s({dateTime:e});if(!t)return{score:r.overallFortune.score,fortune:r.overallFortune.level,summary:r.overallFortune.summary};const a=s({dateTime:t}),o=Math.round((r.overallFortune.score+a.overallFortune.score)/2);let l;l=o>=80?"excellent":o>=60?"good":o>=40?"neutral":o>=20?"bad":"terrible";return{score:o,fortune:l,summary:`시작: ${r.overallFortune.summary} | 종료: ${a.overallFortune.summary}`}}const p=(e={})=>{const{startDate:r,endDate:a,intervalMinutes:o=60,autoCalculate:s=!0}=e,[l,n]=t.useState({timeSlotScores:[],optimalTime:null,isCalculating:!1,error:null}),i=t.useMemo(()=>{if(r)return r;const e=new Date;return e.setHours(0,0,0,0),e},[r]),d=t.useMemo(()=>{if(a)return a;const e=new Date;return e.setHours(23,59,59,999),e},[a]),c=t.useCallback(async()=>{if(s){n(e=>({...e,isCalculating:!0,error:null}));try{await new Promise(e=>setTimeout(e,0));const e=m(i,d,o),t=e.length>0?function(e,t){const r=m(e,t,60);return r.reduce((e,t)=>t.score>e.score?t:e,r[0])}(i,d):null;n({timeSlotScores:e,optimalTime:t,isCalculating:!1,error:null})}catch(e){n(t=>({...t,isCalculating:!1,error:e instanceof Error?e.message:"Calculation failed"}))}}},[i,d,o,s]),p=t.useCallback(()=>{c()},[c]),f=t.useCallback((e,t)=>b(e,t),[]),h=t.useCallback(e=>{const t=l.timeSlotScores.find(t=>t.time.getTime()===e.getTime());if(t)return t;return l.timeSlotScores.reduce((t,r)=>{const a=Math.abs(t.time.getTime()-e.getTime());return Math.abs(r.time.getTime()-e.getTime())<a?r:t},l.timeSlotScores[0])},[l.timeSlotScores]),y=t.useCallback(e=>({icon:u(e),color:x(e),bgColor:g(e)}),[]),v=t.useCallback(e=>!!l.optimalTime&&l.optimalTime.time.getTime()===e.getTime(),[l.optimalTime]),j=t.useCallback(e=>{const t=new Date(e);t.setHours(0,0,0,0);const r=new Date(e);r.setHours(23,59,59,999);const a=l.timeSlotScores.filter(e=>e.time>=t&&e.time<=r);if(0!==a.length)return a.reduce((e,t)=>t.score>e.score?t:e)},[l.timeSlotScores]),N=t.useCallback(e=>l.timeSlotScores.filter(t=>t.fortune===e),[l.timeSlotScores]);return t.useEffect(()=>{s&&c()},[c,s]),{timeSlotScores:l.timeSlotScores,optimalTime:l.optimalTime,isCalculating:l.isCalculating,error:l.error,recalculate:p,evaluateEvent:f,getScoreForTime:h,getBestTimeForDay:j,filterTimeSlotsByFortune:N,isOptimalTime:v,getFortuneDisplay:y}},f=({isOpen:r,onClose:s,onSave:l,event:d,initialDate:m})=>{const{addTodo:u}=a(),[x,g]=t.useState("event"),[b,f]=t.useState({title:"",description:"",start_time:n(m||new Date,"yyyy-MM-dd'T'HH:mm"),end_time:n(m?new Date(m.getTime()+36e5):new Date(Date.now()+36e5),"yyyy-MM-dd'T'HH:mm"),all_day:!1,location:"",type:"personal",color:"#3b82f6",reminder_minutes:15,tags:[]}),[h,y]=t.useState([]),[v,j]=t.useState({text:"",priority:"medium",date:n(m||new Date,"yyyy-MM-dd")}),N=t.useMemo(()=>{if(!b.start_time)return{startDate:new Date,endDate:i(new Date,1)};const e=new Date(b.start_time),t=new Date(e);t.setHours(0,0,0,0);const r=new Date(e);return r.setHours(23,59,59,999),{startDate:t,endDate:r}},[b.start_time]),{evaluateEvent:k,getFortuneDisplay:w,getBestTimeForDay:C}=p({startDate:N.startDate,endDate:N.endDate,autoCalculate:"event"===x}),_=t.useMemo(()=>{if("event"!==x||!b.start_time)return null;const e=new Date(b.start_time),t=b.end_time?new Date(b.end_time):void 0;return k(e,t)},[x,b.start_time,b.end_time,k]),T=t.useMemo(()=>{if("event"!==x||!b.start_time)return null;const e=new Date(b.start_time),t=C(e);return t&&_&&t.score-_.score>=20?t:null},[x,b.start_time,_,C]);t.useEffect(()=>{d?(f(d),y(d.tags||[]),g("event")):m&&(f(e=>({...e,start_time:n(m,"yyyy-MM-dd'T'HH:mm"),end_time:n(new Date(m.getTime()+36e5),"yyyy-MM-dd'T'HH:mm")})),j(e=>({...e,date:n(m,"yyyy-MM-dd")})))},[d,m]);return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-background rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto border border-border",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-foreground",children:d?"일정 수정":"새 작성"}),!d&&e.jsxs("div",{className:"flex mb-6 bg-muted rounded-lg p-1",children:[e.jsx("button",{type:"button",onClick:()=>g("event"),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors "+("event"===x?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:"📅 일정"}),e.jsx("button",{type:"button",onClick:()=>g("todo"),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors "+("todo"===x?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:"✅ 할일"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),"todo"!==x)if(b.title&&b.start_time&&b.end_time)try{const e={title:b.title,description:b.description,start_time:b.start_time?`${b.start_time}:00`:b.start_time,end_time:b.end_time?`${b.end_time}:00`:b.end_time,all_day:b.all_day,location:b.location,type:b.type,color:b.color,reminder_minutes:void 0===b.reminder_minutes?void 0:b.reminder_minutes};let t;(null==d?void 0:d.id)?(t=await o.updateEvent(d.id,e),t.tags=h):(t=await o.createEvent(e),t.tags=h),l(t),s()}catch(t){t.response||t.request,alert(`일정 저장에 실패했습니다: ${t.message||"알 수 없는 오류"}`)}else alert("제목과 시간을 입력해주세요.");else(()=>{if(v.text.trim())try{u({text:v.text.trim(),completed:!1,priority:v.priority,date:v.date}),s()}catch(t){alert("할일 저장에 실패했습니다.")}else alert("할일 내용을 입력해주세요.")})()},className:"space-y-4",children:["todo"===x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-foreground",children:"할일 내용*"}),e.jsx("input",{type:"text",value:v.text,onChange:e=>j({...v,text:e.target.value}),className:"w-full px-3 py-2 border border-border rounded-md focus:ring-2 focus:ring-primary-500 bg-background text-foreground",placeholder:"할일을 입력하세요...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-foreground",children:"우선순위"}),e.jsx("div",{className:"flex space-x-2",children:[{value:"high",label:"높음",icon:"🔴"},{value:"medium",label:"보통",icon:"🟡"},{value:"low",label:"낮음",icon:"🟢"}].map(t=>e.jsxs("button",{type:"button",onClick:()=>j({...v,priority:t.value}),className:"flex-1 py-2 px-3 rounded-md text-sm font-medium border transition-colors "+(v.priority===t.value?"border-primary-500 bg-primary-500/10 text-primary-600":"border-border hover:border-primary-300"),children:[e.jsx("span",{className:"mr-1",children:t.icon}),t.label]},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-foreground",children:"날짜"}),e.jsx("input",{type:"date",value:v.date,onChange:e=>j({...v,date:e.target.value}),className:"w-full px-3 py-2 border border-border rounded-md focus:ring-2 focus:ring-primary-500 bg-background text-foreground",required:!0})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-foreground",children:"제목*"}),e.jsx("input",{type:"text",value:b.title,onChange:e=>f({...b,title:e.target.value}),className:"w-full px-3 py-2 border border-border rounded-md focus:ring-2 focus:ring-primary-500 bg-background text-foreground",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-foreground",children:"설명"}),e.jsx("textarea",{value:b.description||"",onChange:e=>f({...b,description:e.target.value}),className:"w-full px-3 py-2 border border-border rounded-md focus:ring-2 focus:ring-primary-500 bg-background text-foreground",rows:3})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:b.all_day,onChange:e=>f({...b,all_day:e.target.checked}),className:"mr-2"}),e.jsx("label",{className:"text-sm text-foreground",children:"종일"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-foreground",children:"시작*"}),e.jsx("input",{type:"datetime-local",value:b.start_time,onChange:e=>f({...b,start_time:e.target.value}),className:"w-full px-3 py-2 border border-border rounded-md focus:ring-2 focus:ring-primary-500 bg-background text-foreground",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-foreground",children:"종료*"}),e.jsx("input",{type:"datetime-local",value:b.end_time,onChange:e=>f({...b,end_time:e.target.value}),className:"w-full px-3 py-2 border border-border rounded-md focus:ring-2 focus:ring-primary-500 bg-background text-foreground",required:!0})]})]}),_&&e.jsxs("div",{className:"border border-border rounded-md p-4 bg-muted/50",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-2 text-foreground flex items-center",children:[e.jsx("span",{className:"mr-2",children:"🔮"}),"귀문둔갑 시간 평가"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:`flex items-center justify-between p-2 rounded-md ${w(_.fortune).bgColor}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-2xl",children:w(_.fortune).icon}),e.jsxs("div",{children:[e.jsxs("div",{className:`font-medium ${w(_.fortune).color}`,children:["excellent"===_.fortune&&"대길 (大吉)","good"===_.fortune&&"길 (吉)","neutral"===_.fortune&&"평 (平)","bad"===_.fortune&&"흉 (凶)","terrible"===_.fortune&&"대흉 (大凶)"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["점수: ",_.score,"/100"]})]})]})}),e.jsx("p",{className:"text-xs text-foreground/80 leading-relaxed",children:_.summary}),T&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-border",children:[e.jsx("p",{className:"text-xs font-medium text-foreground mb-2",children:"💡 더 좋은 시간 추천"}),e.jsx("button",{type:"button",onClick:()=>{const e=n(T.time,"yyyy-MM-dd'T'HH:mm");f({...b,start_time:e,end_time:b.end_time?n(new Date(T.time.getTime()+(new Date(b.end_time).getTime()-new Date(b.start_time).getTime())),"yyyy-MM-dd'T'HH:mm"):e})},className:"w-full text-left p-2 rounded-md bg-green-100 dark:bg-green-900 hover:bg-green-200 dark:hover:bg-green-800 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-lg",children:"🌟"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-green-700 dark:text-green-300",children:[n(T.time,"HH:mm")," 시작"]}),e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400",children:["점수: ",T.score,"/100 (+",T.score-_.score,"점 향상)"]})]})]}),e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400",children:"적용 →"})]})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-foreground",children:"위치"}),e.jsx("input",{type:"text",value:b.location||"",onChange:e=>f({...b,location:e.target.value}),className:"w-full px-3 py-2 border border-border rounded-md focus:ring-2 focus:ring-primary-500 bg-background text-foreground"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-foreground",children:"유형"}),e.jsxs("select",{value:b.type,onChange:e=>f({...b,type:e.target.value}),className:"w-full px-3 py-2 border border-border rounded-md focus:ring-2 focus:ring-primary-500 bg-background text-foreground",children:[e.jsx("option",{value:"personal",children:"개인"}),e.jsx("option",{value:"work",children:"업무"}),e.jsx("option",{value:"holiday",children:"휴일"}),e.jsx("option",{value:"other",children:"기타"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-foreground",children:"색상"}),e.jsx("input",{type:"color",value:b.color||"#3b82f6",onChange:e=>f({...b,color:e.target.value}),className:"w-full h-10 border border-border rounded-md bg-background"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-foreground",children:"태그"}),e.jsx(c,{selectedTags:h,onTagsChange:y,placeholder:"태그를 선택하거나 새로 만들기",allowCreate:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-foreground",children:"알림 (분)"}),e.jsxs("select",{value:b.reminder_minutes,onChange:e=>f({...b,reminder_minutes:parseInt(e.target.value)}),className:"w-full px-3 py-2 border border-border rounded-md focus:ring-2 focus:ring-primary-500 bg-background text-foreground",children:[e.jsx("option",{value:"0",children:"없음"}),e.jsx("option",{value:"5",children:"5분 전"}),e.jsx("option",{value:"10",children:"10분 전"}),e.jsx("option",{value:"15",children:"15분 전"}),e.jsx("option",{value:"30",children:"30분 전"}),e.jsx("option",{value:"60",children:"1시간 전"}),e.jsx("option",{value:"1440",children:"1일 전"})]})]})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx("div",{children:(null==d?void 0:d.id)&&e.jsx("button",{type:"button",onClick:async()=>{if((null==d?void 0:d.id)&&window.confirm("이 일정을 삭제하시겠습니까?"))try{await o.deleteEvent(d.id),s(),window.location.reload()}catch(e){alert("일정 삭제에 실패했습니다.")}},className:"px-4 py-2 text-red-600 hover:bg-red-500/10 rounded-md",children:"삭제"})}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-foreground hover:bg-muted rounded-md",children:"취소"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-500 text-white rounded-md hover:bg-primary-600",children:d?"수정":"todo"===x?"할일 저장":"일정 저장"})]})]})]})]})}):null};export{f as E,x as a,b as e,u as g};
