# 📊 오행균형도 레이더차트 표준화 개발 작업지시서

## 🎯 프로젝트 목표
- **오행균형도**를 사주분석 페이지 첫 번째 차트로 개발
- **표준화된 레이더차트 포맷** 확립으로 30개 차트 일관성 확보
- **동일한 디자인, 동일한 위치** 원칙으로 사용자 경험 통일

## 🏗️ 시스템 아키텍처 개편

### 1. 사주분석 페이지 구조 변경
```
기존: 생년월일시 입력 → 6대 영역 분석 표시
변경: 생년월일시 입력 → 오행균형도 표시 → 네비게이션으로 다른 차트 이동
```

### 2. 표준 레이더차트 포맷 정의
```typescript
// 모든 차트가 따라야 할 표준 인터페이스
interface StandardRadarChart {
  // 차트 메타데이터
  meta: {
    id: string;           // 'five-elements', 'six-areas', 'seventeen-fortune' etc
    title: string;        // '오행균형도', '6대 영역 분석' etc
    icon: string;         // '🌟', '📊', '🔮' etc
    description: string;  // 차트 설명
    order: number;        // 네비게이션 순서 (1, 2, 3...)
  };

  // 차트 데이터 구조
  data: {
    labels: string[];     // 레이더차트 각 축 라벨
    values: number[];     // 각 축의 값 (0-100)
    colors: {
      primary: string;    // 주 색상
      secondary: string;  // 보조 색상
      background: string; // 배경 색상
    };
  };

  // 시간대별 변화
  timeframes: {
    base: number[];       // 기본값
    today: number[];      // 오늘의 변화
    month: number[];      // 이달의 변화  
    year: number[];       // 올해의 변화
  };

  // 해석 및 조언
  interpretation: {
    summary: string;      // 종합 해석
    positive: string[];   // 긍정적 측면
    negative: string[];   // 주의할 점
    recommendations: string[]; // 개선 방안
  };
}
```

## 🌟 오행균형도 차트 상세 설계

### 1. 데이터 구조 정의
```typescript
// 오행 요소 정의
interface FiveElementsData {
  wood: number;    // 목(木) - 성장, 창조성
  fire: number;    // 화(火) - 열정, 활동성  
  earth: number;   // 토(土) - 안정, 신용
  metal: number;   // 금(金) - 정의, 원칙
  water: number;   // 수(水) - 지혜, 유연성
}

// 오행 관계 분석
interface ElementRelationship {
  mutual_generation: {  // 상생관계
    wood_fire: number;      // 목생화
    fire_earth: number;     // 화생토
    earth_metal: number;    // 토생금
    metal_water: number;    // 금생수
    water_wood: number;     // 수생목
  };
  mutual_destruction: {  // 상극관계
    wood_earth: number;     // 목극토
    fire_metal: number;     // 화극금
    earth_water: number;    // 토극수
    metal_wood: number;     // 금극목
    water_fire: number;     // 수극화
  };
  balance_score: number;   // 전체 균형도 (0-100)
}

// 오행 기반 추천사항
interface FiveElementsRecommendation {
  colors: {
    beneficial: string[];   // 도움되는 색상
    avoid: string[];       // 피해야 할 색상
  };
  directions: {
    beneficial: string[];   // 도움되는 방향
    avoid: string[];       // 피해야 할 방향
  };
  activities: {
    beneficial: string[];   // 추천 활동
    avoid: string[];       // 피해야 할 활동
  };
  lifestyle: {
    diet: string[];        // 식습관 조언
    exercise: string[];    // 운동 추천
    career: string[];      // 직업 적성
  };
}
```

### 2. 차트 시각화 디자인
```typescript
// 오행 전용 색상 시스템
const FIVE_ELEMENTS_COLORS = {
  wood: {
    primary: '#22c55e',      // 싱그러운 녹색
    secondary: '#16a34a',    
    background: 'rgba(34, 197, 94, 0.1)',
    icon: '🌳'
  },
  fire: {
    primary: '#ef4444',      // 역동적인 빨강
    secondary: '#dc2626',
    background: 'rgba(239, 68, 68, 0.1)', 
    icon: '🔥'
  },
  earth: {
    primary: '#f59e0b',      // 안정적인 노랑/갈색
    secondary: '#d97706',
    background: 'rgba(245, 158, 11, 0.1)',
    icon: '🏔️'
  },
  metal: {
    primary: '#6b7280',      // 강인한 회색
    secondary: '#4b5563',
    background: 'rgba(107, 114, 128, 0.1)',
    icon: '⚔️'
  },
  water: {
    primary: '#3b82f6',      // 유연한 파랑
    secondary: '#2563eb',
    background: 'rgba(59, 130, 246, 0.1)',
    icon: '🌊'
  }
};

// 레이더차트 특별 옵션
const FIVE_ELEMENTS_CHART_CONFIG = {
  // 5각형 레이더차트
  type: 'radar',
  aspectRatio: 1,
  
  // 축 설정
  scales: {
    r: {
      beginAtZero: true,
      max: 100,
      ticks: {
        stepSize: 20,
        showLabelBackdrop: false
      },
      pointLabels: {
        font: {
          size: 14,
          weight: 'bold'
        },
        color: (context) => FIVE_ELEMENTS_COLORS[context.label.toLowerCase()].primary
      },
      grid: {
        color: 'rgba(0, 0, 0, 0.1)',
        lineWidth: 2
      },
      angleLines: {
        color: 'rgba(0, 0, 0, 0.1)',
        lineWidth: 1
      }
    }
  },

  // 상생/상극 관계 화살표 표시
  plugins: {
    beforeDraw: (chart) => {
      // 차트 중앙에 상생 화살표 그리기
      drawGenerationCycle(chart);
      // 외곽에 상극 화살표 그리기  
      drawDestructionCycle(chart);
    }
  }
};
```

### 3. 계산 로직 구현
```typescript
// 오행 점수 계산 엔진
class FiveElementsCalculator {
  
  // 생년월일시로부터 오행 점수 계산
  static calculateFromBirthInfo(birthInfo: SajuBirthInfo): FiveElementsData {
    const fourPillars = this.getFourPillars(birthInfo);
    
    return {
      wood: this.calculateWoodStrength(fourPillars),
      fire: this.calculateFireStrength(fourPillars),  
      earth: this.calculateEarthStrength(fourPillars),
      metal: this.calculateMetalStrength(fourPillars),
      water: this.calculateWaterStrength(fourPillars)
    };
  }

  // 시간대별 변화 계산
  static calculateTimeFrameVariations(
    baseElements: FiveElementsData, 
    timeframe: 'today' | 'month' | 'year'
  ): FiveElementsData {
    const variations = {
      today: { wood: 1.1, fire: 1.3, earth: 0.9, metal: 0.8, water: 1.2 },
      month: { wood: 0.9, fire: 1.1, earth: 1.2, metal: 1.1, water: 0.9 },
      year: { wood: 1.2, fire: 0.8, earth: 1.3, metal: 1.0, water: 1.1 }
    };

    const multipliers = variations[timeframe];
    
    return {
      wood: Math.min(100, baseElements.wood * multipliers.wood),
      fire: Math.min(100, baseElements.fire * multipliers.fire),
      earth: Math.min(100, baseElements.earth * multipliers.earth), 
      metal: Math.min(100, baseElements.metal * multipliers.metal),
      water: Math.min(100, baseElements.water * multipliers.water)
    };
  }

  // 균형도 분석
  static analyzeBalance(elements: FiveElementsData): ElementRelationship {
    const values = Object.values(elements);
    const average = values.reduce((sum, val) => sum + val, 0) / 5;
    const variance = values.reduce((sum, val) => sum + Math.pow(val - average, 2), 0) / 5;
    
    return {
      mutual_generation: this.calculateGenerationStrength(elements),
      mutual_destruction: this.calculateDestructionStrength(elements),
      balance_score: Math.max(0, 100 - variance) // 편차가 낮을수록 균형도 높음
    };
  }

  // 개인맞춤 추천사항 생성
  static generateRecommendations(
    elements: FiveElementsData,
    balance: ElementRelationship
  ): FiveElementsRecommendation {
    const dominant = this.getDominantElements(elements);
    const weak = this.getWeakElements(elements);
    
    return {
      colors: this.getColorRecommendations(dominant, weak),
      directions: this.getDirectionRecommendations(dominant, weak), 
      activities: this.getActivityRecommendations(dominant, weak),
      lifestyle: this.getLifestyleRecommendations(dominant, weak)
    };
  }
}
```

## 🎨 UI 컴포넌트 구현

### 1. FiveElementsChart 컴포넌트
```typescript
// /components/saju/charts/FiveElementsChart.tsx
interface FiveElementsChartProps {
  elements: FiveElementsData;
  birthDate?: string;
  showRecommendations?: boolean;
}

const FiveElementsChart: React.FC<FiveElementsChartProps> = ({
  elements,
  birthDate,
  showRecommendations = true
}) => {
  // 표준 레이더차트 훅 사용
  const {
    chartData,
    selectedTimeFrame,
    setSelectedTimeFrame,
    isDarkMode
  } = useStandardRadarChart({
    baseData: elements,
    chartType: 'five-elements',
    calculator: FiveElementsCalculator
  });

  const balance = FiveElementsCalculator.analyzeBalance(elements);
  const recommendations = FiveElementsCalculator.generateRecommendations(elements, balance);

  return (
    <div className={CHART_DESIGN_SYSTEM.LAYOUT.chartContainer.wrapper}>
      {/* 표준 차트 헤더 */}
      <StandardChartHeader 
        title="🌟 오행균형도 분석"
        description="목, 화, 토, 금, 수의 균형과 상생상극 관계"
        birthDate={birthDate}
      />

      {/* 표준 레이더차트 */}
      <div className="mb-6" style={{ height: CHART_DESIGN_SYSTEM.DIMENSIONS.height }}>
        <Radar data={chartData} options={getFiveElementsChartOptions(isDarkMode)} />
      </div>

      {/* 표준 시간대 선택 버튼 */}
      <StandardTimeFrameSelector 
        selected={selectedTimeFrame}
        onChange={setSelectedTimeFrame}
      />

      {/* 오행 특화 정보 패널들 */}
      <BalanceIndicator balance={balance} />
      <ElementStrengthCards elements={elements} />
      {showRecommendations && <RecommendationPanel recommendations={recommendations} />}
    </div>
  );
};
```

### 2. 표준 공통 컴포넌트들
```typescript
// /components/saju/charts/common/StandardChartHeader.tsx
interface StandardChartHeaderProps {
  title: string;
  description: string;
  birthDate?: string;
  icon?: string;
}

// /components/saju/charts/common/StandardTimeFrameSelector.tsx  
interface StandardTimeFrameSelectorProps {
  selected: TimeFrame;
  onChange: (timeFrame: TimeFrame) => void;
  disabled?: TimeFrame[];
}

// /components/saju/charts/common/useStandardRadarChart.ts
interface UseStandardRadarChartOptions {
  baseData: any;
  chartType: string;
  calculator: any;
}
```

## 📱 사주분석 페이지 리팩토링

### 1. 새로운 페이지 플로우
```typescript
const SajuAnalysisPage: React.FC = () => {
  const [currentUser, setCurrentUser] = useState<UserProfile | null>(null);
  const [analysisData, setAnalysisData] = useState<SajuAnalysisData | null>(null);
  
  // 사주 분석 실행 시 오행균형도부터 시작
  const handleAnalysis = (birthInfo: SajuBirthInfo) => {
    const fullAnalysis = SajuAnalysisEngine.analyze(birthInfo);
    
    setAnalysisData({
      // 1순위: 오행균형도
      fiveElements: FiveElementsCalculator.calculateFromBirthInfo(birthInfo),
      
      // 2순위: 6대 영역 (기존)
      sixAreas: fullAnalysis.sixAreas,
      
      // 3순위: 17대 운세 (기존)
      seventeenFortune: fullAnalysis.seventeenFortune,
      
      // 4순위: 7대 성향 (기존)
      personalityTraits: fullAnalysis.personalityTraits,
      
      // 향후 확장: 나머지 26개 차트
      // tenGods: fullAnalysis.tenGods,
      // greatFortune: fullAnalysis.greatFortune,
      // ...
    });
  };

  return (
    <div className={CHART_DESIGN_SYSTEM.LAYOUT.pageContainer}>
      {/* 사용자 선택 패널 */}
      <UserSelectionPanel ... />
      
      {/* 분석 결과 표시 - 오행균형도가 첫 번째 */}
      {analysisData && (
        <div className="space-y-8">
          {/* 1순위: 오행균형도 */}
          <FiveElementsChart 
            elements={analysisData.fiveElements}
            birthDate={formatBirthDate(currentUser?.birthInfo)}
          />

          {/* 차트 네비게이션 */}
          <ChartNavigation showCenter={false} />
          
          {/* 다른 차트들은 네비게이션으로 이동 */}
        </div>
      )}
    </div>
  );
};
```

### 2. 네비게이션 플로우 업데이트
```typescript
// /constants/navigationFlow.ts 수정
export const CHART_NAVIGATION_FLOW: ChartInfo[] = [
  {
    path: '/saju',
    name: '오행균형도',        // 변경: 첫 번째로 이동
    icon: '🌟',
    description: '목화토금수 균형과 상생상극 분석'
  },
  {
    path: '/saju/six-areas',   // 변경: 경로 분리  
    name: '6대 영역 분석',
    icon: '📊',
    description: '기본 사주 6개 영역 종합 분석'
  },
  {
    path: '/saju/detailed',
    name: '17대 운세 분석',
    icon: '🔮', 
    description: '세부적인 17개 운세 영역 분석'
  },
  {
    path: '/saju/personality',
    name: '7대 성향 분석',
    icon: '🧠',
    description: '개성과 성격 특성 7개 영역 분석'
  }
  // 향후 30개까지 확장...
];
```

## 🔧 개발 작업 순서

### Phase 1: 기반 구조 (1주차)
- [ ] `FiveElementsData` 타입 정의
- [ ] `FiveElementsCalculator` 계산 로직 구현
- [ ] 표준 공통 컴포넌트 개발
  - [ ] `StandardChartHeader`
  - [ ] `StandardTimeFrameSelector`
  - [ ] `useStandardRadarChart` 훅

### Phase 2: 오행차트 구현 (2주차)  
- [ ] `FiveElementsChart` 메인 컴포넌트
- [ ] 오행 전용 시각화 요소들
  - [ ] `BalanceIndicator` - 균형도 표시
  - [ ] `ElementStrengthCards` - 각 원소별 강도
  - [ ] `RecommendationPanel` - 맞춤 추천사항
- [ ] 상생상극 관계 시각화

### Phase 3: 페이지 통합 (3주차)
- [ ] `SajuAnalysisPage` 리팩토링
- [ ] 네비게이션 플로우 업데이트  
- [ ] 기존 차트들을 표준 포맷으로 마이그레이션
- [ ] 통합 테스트 및 버그 수정

### Phase 4: 최적화 및 완성 (4주차)
- [ ] 성능 최적화
- [ ] 반응형 디자인 적용
- [ ] 사용자 테스트 및 피드백 반영
- [ ] 다음 차트 개발 준비

## 📊 품질 기준

### 기능적 요구사항
- [ ] 정확한 오행 점수 계산 (오차 ±5% 이내)
- [ ] 시간대별 변화 반영 (오늘/이달/올해)
- [ ] 개인맞춤 추천사항 생성
- [ ] 상생상극 관계 시각화

### 성능 요구사항  
- [ ] 차트 로딩 시간 < 1.5초
- [ ] 계산 처리 시간 < 500ms
- [ ] 메모리 사용량 최적화
- [ ] 모바일 디바이스 대응

### UI/UX 요구사항
- [ ] 기존 차트들과 동일한 디자인 언어
- [ ] 직관적인 오행 색상 시스템
- [ ] 접근성 표준 준수 (WCAG 2.1)
- [ ] 다크모드 완벽 지원

## 🚀 배포 전략

### 개발 단계별 배포
1. **Dev**: 기능 개발 중 지속적 통합
2. **Staging**: QA 및 사용성 테스트
3. **Production**: 단계적 배포 (Feature Flag 활용)

### 롤백 계획
- 기존 6대 영역 분석을 백업으로 유지
- 문제 발생 시 즉시 이전 버전으로 복원
- 사용자 데이터 무손실 보장

---

## 🎯 즉시 실행 액션

### 🔥 TODAY (오늘 시작)
1. **FiveElementsData 타입 정의**
2. **FiveElementsCalculator 기본 구조**
3. **표준 컴포넌트 뼈대 작성**

### ⚡ THIS WEEK
1. 오행 계산 로직 완성
2. FiveElementsChart 프로토타입
3. 사주분석 페이지 통합 테스트

### 📌 NEXT WEEK  
1. 상생상극 시각화 추가
2. 추천사항 로직 고도화
3. 전체 시스템 성능 최적화

---

*PM 지휘 하에 오행균형도를 첫 번째 차트로 하는 표준화된 레이더차트 시스템을 구축하여, 향후 30개 차트의 일관된 기반을 마련하겠습니다.*