# 백엔드 Calendar 서비스 복구 작업지시서

## 🚨 문제 상황
- **증상**: 고객 관리 페이지에서 500 에러 발생
- **원인**: Calendar 백엔드 서비스가 포트 4012에서 실행되지 않음
- **영향**: 
  - 고객 목록 조회 불가
  - 사주 데이터 로딩 불가
  - CustomerManagementPage, CustomerSelector 등 주요 기능 장애

## 🔍 에러 분석
```
ECONNREFUSED - 백엔드 서비스 연결 거부
/api/calendar/customers 엔드포인트 500 에러
Vite proxy가 http://localhost:4012로 요청 전달 실패
```

## ✅ 해결 방안

### 1단계: Calendar 서비스 실행
```bash
# Calendar 서비스 디렉토리 이동
cd packages/backend/services/calendar

# 의존성 설치 (필요시)
npm install

# TypeScript 빌드
npm run build

# 서비스 실행 (포트 4012)
npm run start
# 또는
PORT=4012 npm start
```

### 2단계: API Gateway 실행 (선택사항)
```bash
# API Gateway 디렉토리 이동
cd packages/backend/api-gateway

# 의존성 설치 (필요시)
npm install

# Gateway 실행
npm run start
```

### 3단계: 서비스 정상 동작 확인
```bash
# Calendar API 테스트
curl http://localhost:4012/api/calendar/customers?page=1&limit=20

# 응답 확인
# 정상: JSON 형식의 고객 목록
# 실패: Connection refused 또는 500 에러
```

## 🛠️ 추가 고려사항

### SQLite 데이터베이스 확인
```bash
# calendar.db 파일 존재 여부 확인
dir packages/backend/services/calendar/calendar.db

# 없으면 자동 생성되지만, 권한 문제 확인 필요
```

### 환경 변수 설정
```bash
# packages/backend/services/calendar/.env
PORT=4012
DATABASE_PATH=./calendar.db
NODE_ENV=development
```

### 프로세스 관리 (선택사항)
```bash
# PM2 사용시
pm2 start packages/backend/services/calendar/dist/index.js --name calendar-service

# 로그 확인
pm2 logs calendar-service
```

## 📝 작업 순서
1. [ ] Calendar 서비스 의존성 설치
2. [ ] TypeScript 빌드 실행
3. [ ] 포트 4012에서 서비스 시작
4. [ ] API 엔드포인트 테스트
5. [ ] 프론트엔드에서 고객 목록 로딩 확인
6. [ ] 사주 데이터 정상 표시 확인

## 🎯 예상 결과
- Calendar 서비스가 포트 4012에서 정상 실행
- 고객 목록 API 정상 응답
- 프론트엔드에서 고객 데이터 정상 표시
- 사주 분석 기능 정상 작동

## 🚀 즉시 실행 명령어 (권장)
```bash
# 한 번에 실행
cd packages/backend/services/calendar && npm install && npm run build && PORT=4012 npm start
```

## ⚠️ 주의사항
- 포트 4012가 이미 사용 중이면 프로세스 종료 필요
- SQLite 파일 권한 확인 필요
- 프론트엔드는 포트 4000 유지 (변경 금지)

---
작성일: 2025-01-03
상태: 대기 중