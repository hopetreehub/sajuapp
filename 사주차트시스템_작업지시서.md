# 📊 사주 차트 시스템 개발 작업지시서

## 🎯 프로젝트 목표
생년월일시를 입력받아 20~30개의 전문 사주 차트를 생성하는 마이크로서비스 기반 시스템 구축

## 🏗 시스템 아키텍처

### 마이크로서비스 구조
```
sajuapp/
├── packages/
│   ├── web/                      # 프론트엔드 (포트 4000 고정)
│   │   └── src/
│   │       ├── pages/
│   │       │   └── SajuAnalysisPage.tsx   # 메인 사주 분석 페이지
│   │       ├── components/
│   │       │   └── saju/
│   │       │       ├── SajuInputForm.tsx   # 생년월일시 입력
│   │       │       ├── SajuChartGrid.tsx   # 차트 그리드 레이아웃
│   │       │       └── charts/             # 개별 차트 컴포넌트
│   │       │           ├── SixAreaChart.tsx      # 6대 영역 차트
│   │       │           ├── FiveElementChart.tsx  # 오행 분석 차트
│   │       │           ├── TenGodsChart.tsx      # 십성 분석 차트
│   │       │           ├── YearlyFortune.tsx     # 연간 운세 차트
│   │       │           └── ... (20개 이상)
│   │       └── services/
│   │           └── sajuService.ts          # 사주 API 호출
│   └── backend/
│       └── services/
│           └── saju/                        # 사주 마이크로서비스
│               ├── src/
│               │   ├── calculators/        # 사주 계산 엔진
│               │   ├── analyzers/          # 분석 모듈
│               │   └── routes/             # API 엔드포인트
│               └── data/
│                   └── manseryeok.db        # 만세력 데이터
```

## 📈 차트 종류 (Phase 1: 10개)

### 1. 기본 분석 차트
1. **6대 영역 분석** (완성 예시 보유)
   - 근본, 사고, 인연, 행동, 행운, 환경
   - Radar Chart 형태

2. **오행 균형도**
   - 목, 화, 토, 금, 수 비율
   - Doughnut Chart

3. **십성 분포도**
   - 비견, 겁재, 식신, 상관, 정재, 편재, 정관, 편관, 정인, 편인
   - Bar Chart

4. **대운 흐름도**
   - 10년 단위 운세 변화
   - Line Chart

5. **월별 운세**
   - 12개월 운세 점수
   - Area Chart

### 2. 심화 분석 차트
6. **직업 적합도**
   - 직업군별 매칭 점수
   - Horizontal Bar Chart

7. **건강 지표**
   - 장기별 건강 상태
   - Polar Area Chart

8. **재물운 예측**
   - 연도별 재물운
   - Candlestick Chart

9. **인간관계 맵**
   - 관계 유형별 점수
   - Spider Chart

10. **감정 패턴**
    - 감정 기복 분석
    - Wave Chart

## 🛠 기술 스택

### Frontend
```json
{
  "charts": "react-chartjs-2",  // Chart.js React 래퍼
  "chartjs": "chart.js",         // 차트 라이브러리
  "date": "date-fns",            // 날짜 처리
  "calendar": "korean-lunar-calendar"  // 음력 변환
}
```

### Backend
```json
{
  "database": "sqlite3",          // 만세력 데이터
  "framework": "express",
  "validation": "joi",
  "calculation": "saju-calculator"  // 사주 계산 엔진 (자체 개발)
}
```

## 📝 개발 단계

### Phase 1: 기초 구축 (Week 1)
#### Day 1-2: 환경 설정
```bash
# Chart.js 설치
cd packages/web
npm install chart.js react-chartjs-2
npm install korean-lunar-calendar date-fns

# 사주 서비스 생성
cd packages/backend/services
mkdir saju && cd saju
npm init -y
npm install express sqlite3 joi cors
```

#### Day 3-4: 사주 입력 폼
- 생년월일시 입력 UI
- 양력/음력 변환
- 시간대 선택

#### Day 5-7: 첫 번째 차트
- 6대 영역 차트 구현
- API 연동
- 테스트

### Phase 2: 차트 확장 (Week 2)
- 10개 기본 차트 완성
- 차트 그리드 레이아웃
- 반응형 디자인

### Phase 3: 데이터 서비스 (Week 3)
- 만세력 DB 구축
- 사주 계산 엔진
- API 엔드포인트

## 💻 즉시 구현 코드

### 1. 사주 데이터 타입 정의
```typescript
// types/saju.ts
export interface SajuData {
  birthDate: {
    year: number;
    month: number;
    day: number;
    hour: number;
    minute: number;
    isLunar: boolean;
  };
  fourPillars: {
    year: { heavenly: string; earthly: string };
    month: { heavenly: string; earthly: string };
    day: { heavenly: string; earthly: string };
    hour: { heavenly: string; earthly: string };
  };
  charts: {
    sixAreas: {
      foundation: number;  // 근본
      thinking: number;    // 사고
      relationship: number; // 인연
      action: number;      // 행동
      luck: number;        // 행운
      environment: number; // 환경
    };
    fiveElements: {
      wood: number;   // 목
      fire: number;   // 화
      earth: number;  // 토
      metal: number;  // 금
      water: number;  // 수
    };
    // ... 추가 차트 데이터
  };
}
```

### 2. 차트 컴포넌트 템플릿
```typescript
// components/saju/charts/ChartTemplate.tsx
import React from 'react';
import {
  Chart as ChartJS,
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  Title,
  Tooltip,
  Legend,
  RadialLinearScale,
  Filler
} from 'chart.js';
import { Radar, Bar, Line, Doughnut } from 'react-chartjs-2';

ChartJS.register(
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  RadialLinearScale,
  Title,
  Tooltip,
  Legend,
  Filler
);

interface ChartProps {
  data: any;
  title: string;
  type: 'radar' | 'bar' | 'line' | 'doughnut';
}

export const SajuChart: React.FC<ChartProps> = ({ data, title, type }) => {
  const options = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { position: 'top' as const },
      title: { display: true, text: title }
    }
  };

  const ChartComponent = {
    radar: Radar,
    bar: Bar,
    line: Line,
    doughnut: Doughnut
  }[type];

  return (
    <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
      <div style={{ height: '400px' }}>
        <ChartComponent data={data} options={options} />
      </div>
    </div>
  );
};
```

### 3. API 엔드포인트
```typescript
// backend/services/saju/routes/analysis.ts
app.post('/api/saju/analyze', async (req, res) => {
  const { year, month, day, hour, minute, isLunar } = req.body;
  
  // 1. 양력/음력 변환
  const solarDate = isLunar ? convertToSolar(year, month, day) : { year, month, day };
  
  // 2. 사주 계산
  const fourPillars = calculateFourPillars(solarDate, hour, minute);
  
  // 3. 차트 데이터 생성
  const charts = {
    sixAreas: calculateSixAreas(fourPillars),
    fiveElements: calculateFiveElements(fourPillars),
    tenGods: calculateTenGods(fourPillars),
    // ... 추가 분석
  };
  
  res.json({ fourPillars, charts });
});
```

## 🚀 실행 계획

### 오늘 할 일 (Day 1)
1. ✅ Chart.js 설치
2. ✅ SajuAnalysisPage 생성
3. ✅ 6대 영역 차트 구현
4. ✅ 생년월일시 입력 폼

### 내일 할 일 (Day 2)
1. 오행 균형도 차트
2. 십성 분포도 차트
3. API 연동

### 주요 마일스톤
- Week 1: 기본 시스템 + 3개 차트
- Week 2: 10개 차트 완성
- Week 3: 20개 차트 완성
- Week 4: 30개 차트 + 최적화

## 📊 성공 지표
- 차트 로딩 시간: < 2초
- 동시 렌더링: 10개 차트
- 반응형: 모바일/태블릿/PC
- 정확도: 전문가 검증 98%

## ⚡ 차별화 포인트
1. **마이크로서비스**: 차트별 독립 모듈
2. **실시간 계산**: 캐시 없이 즉시 생성
3. **커스터마이징**: 사용자 맞춤 차트
4. **공유 기능**: 이미지/PDF 내보내기

---

## 🔥 즉시 시작 명령어

```bash
# 1. Chart.js 설치 (지금 바로!)
cd packages/web && npm install chart.js react-chartjs-2

# 2. 페이지 생성
touch src/pages/SajuAnalysisPage.tsx

# 3. 차트 컴포넌트 생성
mkdir -p src/components/saju/charts
touch src/components/saju/charts/SixAreaChart.tsx

# 4. 서버 재시작 (포트 4000!)
npx vite --port 4000
```

---

*작성일: 2025-08-27*  
*버전: 1.0*  
*목표: 30개 전문 사주 차트 시스템*