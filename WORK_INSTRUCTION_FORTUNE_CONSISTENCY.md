# 운세 일관성 문제 해결 작업 지시서

## 🔍 문제 분석

### 현재 상황
1. **HomePage.tsx**와 **TodayFortuneSection.tsx** 모두에서 운세를 독립적으로 계산
2. 두 컴포넌트 모두 localStorage에서 생년월일 정보를 읽어와 Store에 동기화
3. 동일한 `calculateDailyFortune` 함수를 사용하지만 별개로 계산하여 일관성 문제 발생 가능

### 문제점
- **중복 계산**: 동일한 운세 계산을 여러 컴포넌트에서 반복
- **동기화 문제**: localStorage → Store 동기화 로직이 중복되어 타이밍 이슈 가능
- **유지보수 어려움**: 동일한 로직이 여러 곳에 분산되어 있음

## 🎯 해결 방안

### 방안 1: 운세 데이터 중앙화 (권장)
**장점**
- 한 곳에서만 운세를 계산하여 일관성 보장
- 성능 향상 (중복 계산 제거)
- 유지보수 용이

**구현 방법**
1. 운세 전용 Store 생성 (`fortuneStore.ts`)
2. Store에서 운세 계산 및 캐싱
3. HomePage와 TodayFortuneSection에서 Store 데이터만 사용

### 방안 2: 홈페이지에서 운세 섹션 제거
**장점**
- 즉시 문제 해결
- 코드 간소화
- 중복 제거

**단점**
- 사용자 경험 저하 (홈에서 운세를 바로 볼 수 없음)
- 운세 접근성 감소

### 방안 3: 운세를 Context로 관리
**장점**
- React 패턴에 부합
- 컴포넌트 간 데이터 공유 용이

**구현 방법**
1. FortuneContext 생성
2. App 레벨에서 Provider 설정
3. 필요한 컴포넌트에서 useContext로 사용

## 📋 작업 계획

### 옵션 A: 중앙화 구현 (권장)
```
1. fortuneStore.ts 생성
   - 운세 계산 로직 통합
   - 날짜별 캐싱 구현
   - birthInfo 변경 시 자동 재계산

2. HomePage.tsx 수정
   - fortuneStore에서 데이터 가져오기
   - localStorage 동기화 로직 제거

3. TodayFortuneSection.tsx 수정
   - fortuneStore에서 데이터 가져오기
   - localStorage 동기화 로직 제거

4. 테스트 및 검증
   - 홈페이지와 캘린더 간 운세 일치 확인
   - 날짜 변경 시 운세 업데이트 확인
```

### 옵션 B: 홈에서 제거 (간단)
```
1. HomePage.tsx 수정
   - 운세 섹션 완전 제거
   - 운세 계산 로직 제거
   - UI에서 "오늘의 운세 한눈에 보기" 카드 제거

2. 운세 바로가기 링크 추가
   - "오늘의 운세" 기능 카드에 집중
   - 캘린더 페이지로 직접 연결
```

## ⚡ 즉시 실행 가능한 임시 해결책

### 빠른 수정 (5분)
```typescript
// HomePage.tsx에서 운세 섹션 조건부 렌더링
{false && ( // 임시로 운세 섹션 숨기기
  <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 mb-12">
    {/* 운세 섹션 내용 */}
  </div>
)}
```

## 🚀 권장 실행 순서

1. **즉시**: 임시 해결책 적용 (홈에서 운세 섹션 숨기기)
2. **단기 (1-2시간)**: fortuneStore 구현 및 중앙화
3. **장기**: 전체적인 상태 관리 아키텍처 개선

## ✅ 성공 지표

- [ ] 홈페이지와 캘린더의 운세가 100% 일치
- [ ] 날짜 변경 시 모든 컴포넌트에서 동일한 운세 표시
- [ ] localStorage 동기화 로직 중복 제거
- [ ] 성능 개선 (중복 계산 제거)

## 📝 참고사항

- 현재 최근 커밋에서 "운세 일관성 완성" 메시지가 있으나 실제로는 여전히 문제 존재
- `date-fns-tz` 패키지 추가됨 (시간대 관련 처리용)
- Railway 배포 준비 중이므로 빠른 해결 필요

---

**작성일**: 2025-09-26
**우선순위**: 높음
**예상 소요시간**: 옵션 A (2시간), 옵션 B (10분)