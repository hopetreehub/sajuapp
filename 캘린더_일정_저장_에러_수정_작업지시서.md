# 🔧 캘린더 일정 저장 에러 수정 작업지시서

## 🎯 문제 현황
캘린더에서 일정을 저장할 때 에러가 발생하고 있음

## 🔍 예상 원인 분석

### 1️⃣ 가능한 원인들
1. **백엔드 서버 연결 문제**
   - Calendar Service가 올바른 포트에서 실행되지 않음
   - API 엔드포인트 경로 불일치
   - CORS 설정 문제

2. **프론트엔드 API 호출 문제**
   - eventService의 API 호출 로직 오류
   - 요청 데이터 형식 불일치
   - 인증/권한 문제

3. **데이터베이스 연결 문제**
   - SQLite 데이터베이스 파일 권한 오류
   - 테이블 스키마 불일치
   - 데이터 유효성 검증 실패

4. **타입스크립트 타입 불일치**
   - CalendarEvent 인터페이스 불일치
   - API 요청/응답 타입 문제

## 🚀 진단 및 수정 계획

### Phase 1: 문제 진단 (30분)
```
1. 브라우저 개발자 도구 확인
   - Console 탭에서 JavaScript 에러 확인
   - Network 탭에서 API 호출 상태 확인
   - 실패한 요청의 응답 메시지 분석

2. 백엔드 서버 상태 확인
   - Calendar Service 실행 상태 점검
   - 포트 4003/4012 연결 확인
   - 서버 로그 분석

3. 데이터베이스 상태 확인
   - SQLite 파일 존재 및 권한 확인
   - 테이블 스키마 검증
   - 샘플 데이터 삽입 테스트
```

### Phase 2: API 연결 점검 (20분)
```
1. API 엔드포인트 테스트
   - curl로 직접 API 호출 테스트
   - 요청/응답 형식 검증
   - 에러 응답 메시지 분석

2. 프론트엔드 API 서비스 점검
   - eventService.ts 로직 검토
   - API 호출 URL 확인
   - 요청 헤더 및 바디 검증

3. 프록시 설정 확인
   - vite.config.ts 프록시 설정
   - /api 경로 라우팅 확인
```

### Phase 3: 에러 수정 (40분)
```
1. 백엔드 수정 (필요시)
   - Calendar Service 재시작
   - API 라우트 수정
   - 데이터베이스 연결 수정
   - CORS 설정 추가

2. 프론트엔드 수정 (필요시)
   - eventService API 호출 로직 수정
   - 에러 핸들링 개선
   - 타입 정의 수정

3. 통합 테스트
   - 일정 생성 테스트
   - 일정 수정 테스트
   - 일정 삭제 테스트
   - 일정 조회 테스트
```

## 🔍 상세 진단 체크리스트

### 백엔드 진단
- [ ] Calendar Service 실행 상태 확인
- [ ] 포트 4003 또는 4012에서 정상 응답하는지 확인
- [ ] `/api/events` 엔드포인트 접근 가능한지 확인
- [ ] SQLite 데이터베이스 파일 권한 확인
- [ ] 서버 로그에서 에러 메시지 확인

### 프론트엔드 진단
- [ ] 브라우저 Console 에러 메시지 확인
- [ ] Network 탭에서 API 요청 상태 확인
- [ ] eventService.ts의 API 호출 로직 검토
- [ ] CalendarEvent 타입 정의 일치성 확인
- [ ] EventModal 컴포넌트 데이터 전송 로직 확인

### API 통신 진단
- [ ] vite.config.ts 프록시 설정 확인
- [ ] `/api/*` 경로가 올바른 백엔드로 라우팅되는지 확인
- [ ] CORS 에러 발생 여부 확인
- [ ] 요청 헤더 (Content-Type 등) 올바른지 확인

## 🛠 예상 수정 사항

### 1. 백엔드 Calendar Service 문제
```bash
# Calendar Service 재시작
cd packages/backend/services/calendar
PORT=4003 npx ts-node --transpile-only src/index.ts

# 또는 포트 4012로 실행
cd packages/backend/services/calendar
set CALENDAR_SERVICE_PORT=4012 && npx ts-node --transpile-only src/index.ts
```

### 2. 프론트엔드 API 호출 문제
```typescript
// eventService.ts 수정 예시
const API_BASE_URL = 'http://localhost:4003/api'; // 또는 4012

export const eventService = {
  async createEvent(event: Omit<CalendarEvent, 'id'>): Promise<CalendarEvent> {
    try {
      const response = await fetch(`${API_BASE_URL}/events`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(event),
      });
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      return await response.json();
    } catch (error) {
      console.error('Create event error:', error);
      throw error;
    }
  }
};
```

### 3. vite.config.ts 프록시 설정 수정
```typescript
export default defineConfig({
  // ...
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:4003', // 또는 4012
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '/api')
      }
    }
  }
});
```

### 4. CalendarEvent 타입 정의 통일
```typescript
// 프론트엔드와 백엔드의 CalendarEvent 인터페이스 일치 확인
interface CalendarEvent {
  id?: string;
  title: string;
  description?: string;
  start_time: string;  // ISO 8601 문자열
  end_time: string;    // ISO 8601 문자열
  all_day: boolean;
  type: 'personal' | 'work' | 'other';
  user_id: string;
}
```

## 📊 테스트 시나리오

### 기본 CRUD 테스트
1. **일정 생성 테스트**
   - EventModal에서 새 일정 작성
   - 필수 필드 입력 후 저장 클릭
   - 성공 시 캘린더에 일정 표시 확인

2. **일정 수정 테스트**
   - 기존 일정 클릭하여 모달 오픈
   - 내용 수정 후 저장
   - 변경사항 반영 확인

3. **일정 삭제 테스트**
   - 일정 삭제 기능 실행
   - 캘린더에서 제거 확인

4. **일정 조회 테스트**
   - 페이지 새로고침 후 일정 로드 확인
   - 각 뷰(월/주/일)에서 일정 표시 확인

### 에러 상황 테스트
1. **네트워크 에러 처리**
   - 백엔드 서버 중지 상태에서 일정 저장 시도
   - 적절한 에러 메시지 표시 확인

2. **유효성 검증 테스트**
   - 빈 제목으로 일정 저장 시도
   - 잘못된 날짜/시간 입력 테스트

## 🚨 응급 해결 방법

만약 빠른 해결이 필요한 경우:

```bash
# 1. 모든 서버 프로세스 종료
taskkill /f /im node.exe

# 2. Calendar Service 재시작
cd packages/backend/services/calendar
PORT=4003 npx ts-node --transpile-only src/index.ts

# 3. 프론트엔드 재시작 (다른 터미널)
cd packages/web
PORT=4000 npx vite --port 4000 --force

# 4. 브라우저 캐시 클리어 후 재접속
```

## ✅ 완료 기준
- [ ] 일정 생성이 정상적으로 동작함
- [ ] 일정 수정이 정상적으로 동작함  
- [ ] 일정 삭제가 정상적으로 동작함
- [ ] 일정 조회가 정상적으로 동작함
- [ ] 에러 발생 시 적절한 메시지가 표시됨
- [ ] 모든 캘린더 뷰에서 일정이 올바르게 표시됨

---

**예상 작업 시간**: 1.5시간  
**우선순위**: 긴급 (사용자 기능에 직접 영향)  
**영향 범위**: 캘린더 전체 기능