# 일기장 추가 기능 작업 지시서 2

## 📋 작업 개요
- **프로젝트**: 운명나침반 일기장 시스템
- **작업 유형**: 버그 수정 및 기능 개선
- **담당자**: Claude Code
- **작성일**: 2025-09-05

## 🐛 1. 일기 저장 실패 문제 해결

### 1.1 문제 현상
- 일기 저장 시 "일기 저장에 실패했습니다" 오류 메시지 발생
- WebP 압축 기능 추가 후 저장 문제 발생 추정

### 1.2 원인 분석 필요사항
- [ ] 브라우저 개발자 도구에서 네트워크 탭 확인
- [ ] 백엔드 API 응답 상태 확인
- [ ] 이미지 데이터 크기 및 포맷 검증
- [ ] Base64 인코딩 데이터 무결성 확인

### 1.3 수정 작업
- [ ] API 호출 에러 로그 상세화
- [ ] 이미지 데이터 전송 문제 해결
- [ ] 에러 핸들링 개선
- [ ] 저장 실패 시 사용자 피드백 개선

## 🖼️ 2. 이미지 확대 보기 기능 추가

### 2.1 기능 요구사항
- 일기에 첨부된 사진 썸네일 클릭 시 큰 사진으로 확대 보기
- 모달 또는 오버레이 형태의 이미지 뷰어 구현
- 여러 이미지가 있을 경우 좌우 네비게이션 제공

### 2.2 UI/UX 설계
- [ ] 이미지 클릭 시 전체 화면 오버레이 표시
- [ ] 확대된 이미지 중앙 정렬 표시
- [ ] 배경 클릭 또는 ESC 키로 닫기
- [ ] 여러 이미지 시 이전/다음 버튼 추가
- [ ] 이미지 번호 표시 (1/3, 2/3 등)
- [ ] 부드러운 페이드 인/아웃 애니메이션

### 2.3 구현 세부사항

#### 2.3.1 ImageViewer 컴포넌트 생성
```typescript
interface ImageViewerProps {
  images: string[]
  currentIndex: number
  isOpen: boolean
  onClose: () => void
  onNext?: () => void
  onPrev?: () => void
}
```

#### 2.3.2 기능 구현
- [ ] 이미지 로딩 상태 표시
- [ ] 이미지 확대/축소 기능 (선택사항)
- [ ] 터치/마우스 드래그로 이미지 이동
- [ ] 키보드 네비게이션 (좌우 화살표, ESC)

#### 2.3.3 DiaryBookModal 연동
- [ ] 썸네일 클릭 이벤트 핸들러 추가
- [ ] ImageViewer 컴포넌트 integration
- [ ] 현재 이미지 인덱스 상태 관리

### 2.4 스타일링 요구사항
- [ ] 다크모드 지원
- [ ] 반응형 디자인 (모바일 친화적)
- [ ] 깔끔한 UI/UX (블러 배경, 그림자 효과)
- [ ] 로딩 스피너 및 애니메이션

## 🔧 3. 기술 구현 세부사항

### 3.1 파일 구조
```
src/components/
├── DiaryBookModal.tsx (수정)
├── ImageViewer.tsx (신규)
└── ui/
    ├── Modal.tsx (활용)
    └── Button.tsx (활용)
```

### 3.2 상태 관리
```typescript
// DiaryBookModal에 추가할 상태
const [imageViewerOpen, setImageViewerOpen] = useState(false)
const [currentImageIndex, setCurrentImageIndex] = useState(0)
```

### 3.3 이벤트 핸들링
```typescript
const handleImageClick = (index: number) => {
  setCurrentImageIndex(index)
  setImageViewerOpen(true)
}

const handleCloseImageViewer = () => {
  setImageViewerOpen(false)
}

const handleNextImage = () => {
  setCurrentImageIndex((prev) => (prev + 1) % images.length)
}

const handlePrevImage = () => {
  setCurrentImageIndex((prev) => (prev - 1 + images.length) % images.length)
}
```

## 🧪 4. 테스트 시나리오

### 4.1 일기 저장 테스트
- [ ] 텍스트만 있는 일기 저장
- [ ] 이미지 1장 포함 일기 저장
- [ ] 이미지 3장 포함 일기 저장
- [ ] 큰 이미지 (10MB+) 저장 테스트
- [ ] 네트워크 오류 시나리오 테스트

### 4.2 이미지 뷰어 테스트
- [ ] 단일 이미지 확대 보기
- [ ] 다중 이미지 네비게이션
- [ ] 키보드 네비게이션 (화살표, ESC)
- [ ] 모바일 터치 제스처
- [ ] 다크모드에서 동작 확인

## 📋 5. 완료 체크리스트

### 5.1 일기 저장 수정
- [ ] 저장 실패 원인 파악
- [ ] API 호출 로직 수정
- [ ] 에러 핸들링 개선
- [ ] 저장 성공/실패 피드백 개선

### 5.2 이미지 뷰어 구현
- [ ] ImageViewer 컴포넌트 생성
- [ ] 썸네일 클릭 이벤트 연결
- [ ] 이미지 네비게이션 구현
- [ ] 키보드/터치 제스처 지원
- [ ] 반응형 디자인 적용

### 5.3 테스트 및 검증
- [ ] 기능 동작 테스트
- [ ] 다양한 브라우저 호환성 확인
- [ ] 모바일 디바이스 테스트
- [ ] 성능 최적화 확인

## ⚠️ 주의사항

1. **일기 저장 문제 우선 해결**: 이미지 뷰어보다 저장 기능 수정이 우선
2. **이미지 메모리 관리**: 큰 이미지 로딩 시 메모리 사용량 고려
3. **접근성**: 키보드 네비게이션 및 스크린 리더 지원
4. **성능**: 이미지 로딩 최적화 및 레이지 로딩 고려

## 📝 작업 순서

1. **1단계**: 일기 저장 실패 문제 디버깅 및 해결
2. **2단계**: ImageViewer 컴포넌트 기본 구조 생성
3. **3단계**: 이미지 확대 보기 기본 기능 구현
4. **4단계**: 네비게이션 및 키보드 제스처 추가
5. **5단계**: 스타일링 및 애니메이션 적용
6. **6단계**: 테스트 및 버그 수정

---

**작업 완료 시 보고 필요사항:**
- 저장 문제 해결 결과
- 이미지 뷰어 동작 스크린샷
- 테스트 결과 요약
- 추가 개선사항 제안