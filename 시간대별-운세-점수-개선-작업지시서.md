# 시간대별 운세 점수 개선 작업지시서

## 🚨 현재 문제점

### 발견된 이슈
- **오늘/이달/올해 점수가 기본 점수보다 항상 낮게 나타남**
- 상생 관계에서도 충분한 가산점이 없음
- 상극 관계의 감점이 너무 큼
- 시간대별 특별 보정이 없음

### 현재 로직의 문제
```typescript
// 현재: 상생 +15, 상극 -10 (오늘)
// 문제: 기본 점수가 50-70인데 변동폭이 너무 작음
```

## ✅ 개선 방안

### 1. 점수 계산 로직 재설계

#### 1.1 기본 원칙
- **기본 점수**: 사주 기반 40-70점
- **시간 보정**: -30 ~ +30점 범위
- **최종 점수**: 20-90점 범위

#### 1.2 시간대별 가중치
```typescript
오늘 (일운):
  - 천간 일치: +20점
  - 지지 일치: +15점
  - 오행 상생: +25점
  - 오행 상극: -15점
  - 오행 비화: +10점 (같은 오행)
  - 합/충/형/파해: 별도 계산

이달 (월운):
  - 천간 일치: +18점
  - 지지 일치: +12점
  - 오행 상생: +20점
  - 오행 상극: -12점
  - 계절 조화: +10점

올해 (세운):
  - 천간 일치: +15점
  - 지지 일치: +10점
  - 오행 상생: +15점
  - 오행 상극: -10점
  - 대운 조화: +12점
```

### 2. 추가 고려사항

#### 2.1 계절별 오행 강약
```typescript
봄(2-4월): 목 +20%, 화 +10%, 금 -10%
여름(5-7월): 화 +20%, 토 +10%, 수 -10%
환절기(1,4,7,10월): 토 +20%
가을(8-10월): 금 +20%, 수 +10%, 목 -10%
겨울(11-1월): 수 +20%, 목 +10%, 화 -10%
```

#### 2.2 시간대별 오행 강약
```typescript
자시(23-01): 수 +15%
축시(01-03): 토 +10%, 수 +5%
인시(03-05): 목 +15%
묘시(05-07): 목 +15%
진시(07-09): 토 +10%, 목 +5%
사시(09-11): 화 +15%
오시(11-13): 화 +15%
미시(13-15): 토 +10%, 화 +5%
신시(15-17): 금 +15%
유시(17-19): 금 +15%
술시(19-21): 토 +10%, 금 +5%
해시(21-23): 수 +15%
```

#### 2.3 특별 가산점
```typescript
// 삼합 (지지)
인오술(火): 화 관련 항목 +20
신자진(水): 수 관련 항목 +20
사유축(金): 금 관련 항목 +20
해묘미(木): 목 관련 항목 +20

// 육합 (지지)
자축(土): 토 관련 +15
인해(木): 목 관련 +15
묘술(火): 화 관련 +15
진유(金): 금 관련 +15
사신(水): 수 관련 +15
오미(火): 화 관련 +15

// 천간합
갑기(土): 토 관련 +18
을경(金): 금 관련 +18
병신(水): 수 관련 +18
정임(木): 목 관련 +18
무계(火): 화 관련 +18
```

## 📊 개선된 점수 분포 예시

### Before (현재)
- 기본: 65점
- 오늘: 55점 (항상 낮음)
- 이달: 58점 (항상 낮음)
- 올해: 60점 (항상 낮음)

### After (개선 후)
- 기본: 65점
- 오늘: 45-85점 (변동 폭 큼)
- 이달: 50-80점 (중간 변동)
- 올해: 55-75점 (작은 변동)

## 🔧 구현 계획

### Phase 1: 점수 계산 함수 개선
```typescript
function calculateTimeBasedScore(
  itemName: string,
  sajuData: SajuData,
  timeFrame: 'today' | 'month' | 'year'
): number {
  const baseScore = calculateSajuScore(itemName, sajuData);
  
  // 1. 기본 보정값 (평균적으로 양수가 되도록)
  let modifier = 5; // 기본 +5점
  
  // 2. 천간지지 일치 보너스 (큰 가산점)
  modifier += calculateExactMatchBonus(sajuData, timeFrame);
  
  // 3. 오행 관계 (균형있게)
  modifier += calculateOhhaengRelation(itemName, sajuData, timeFrame);
  
  // 4. 계절/시간 보정
  modifier += calculateSeasonalBonus(itemName, timeFrame);
  
  // 5. 특별 조합 (삼합, 육합 등)
  modifier += calculateSpecialCombination(sajuData, timeFrame);
  
  // 6. 랜덤 요소 (약간의 변동성)
  modifier += Math.random() * 10 - 5;
  
  return Math.max(20, Math.min(90, baseScore + modifier));
}
```

### Phase 2: 세부 계산 로직

#### 2.1 천간지지 일치 보너스
```typescript
function calculateExactMatchBonus(
  sajuData: SajuData,
  timeFrame: string
): number {
  const now = new Date();
  let bonus = 0;
  
  switch(timeFrame) {
    case 'today':
      const todayPillar = calculateDayPillar(now);
      if (sajuData.day.gan === todayPillar.gan) bonus += 20;
      if (sajuData.day.ji === todayPillar.ji) bonus += 15;
      break;
    
    case 'month':
      const monthPillar = calculateMonthPillar(now);
      if (sajuData.month.gan === monthPillar.gan) bonus += 18;
      if (sajuData.month.ji === monthPillar.ji) bonus += 12;
      break;
      
    case 'year':
      const yearPillar = calculateYearPillar(now);
      if (sajuData.year.gan === yearPillar.gan) bonus += 15;
      if (sajuData.year.ji === yearPillar.ji) bonus += 10;
      break;
  }
  
  return bonus;
}
```

#### 2.2 오행 관계 개선
```typescript
function calculateOhhaengRelation(
  itemName: string,
  sajuData: SajuData,
  timeFrame: string
): number {
  const itemOhhaeng = ITEM_OHHAENG_MAPPING[itemName];
  const currentOhhaeng = getCurrentOhhaeng(timeFrame);
  
  let score = 0;
  
  itemOhhaeng.forEach(oh => {
    // 상생 관계 (큰 가산점)
    if (OHHAENG_RELATIONS.상생[currentOhhaeng] === oh) {
      score += timeFrame === 'today' ? 25 : 
               timeFrame === 'month' ? 20 : 15;
    }
    // 같은 오행 (비화 - 중간 가산점)
    else if (currentOhhaeng === oh) {
      score += timeFrame === 'today' ? 15 : 
               timeFrame === 'month' ? 12 : 10;
    }
    // 상극 관계 (적당한 감점)
    else if (OHHAENG_RELATIONS.상극[currentOhhaeng] === oh) {
      score -= timeFrame === 'today' ? 15 : 
               timeFrame === 'month' ? 12 : 10;
    }
  });
  
  return score;
}
```

## 📋 테스트 시나리오

### 시나리오 1: 목 오행이 강한 사람
- 봄철(목 왕성): 목 관련 항목 70 → 85점
- 여름철(화 왕성): 목이 화를 생하므로 75점
- 가을철(금 왕성): 금이 목을 극하므로 55점
- 겨울철(수 왕성): 수가 목을 생하므로 80점

### 시나리오 2: 천간 일치
- 갑자일생이 갑자일에: 기본 65 → 85점 (+20)
- 갑자일생이 을축일에: 기본 65 → 65점 (변동 없음)
- 갑자일생이 경오일에: 기본 65 → 50점 (상극)

## ✅ 체크리스트

- [ ] calculateTimeBasedScore 함수 전면 개선
- [ ] 천간지지 일치 보너스 구현
- [ ] 오행 관계 점수 균형 조정
- [ ] 계절별 오행 강약 반영
- [ ] 시간대별 오행 강약 반영
- [ ] 삼합/육합 특별 조합 구현
- [ ] 최소 30% 이상 긍정적 변동 보장
- [ ] 테스트 케이스 작성 및 검증

## 🎯 목표

1. **오늘 운세**: 40%는 상승, 40%는 하락, 20%는 유지
2. **이달 운세**: 45%는 상승, 35%는 하락, 20%는 유지
3. **올해 운세**: 50%는 상승, 30%는 하락, 20%는 유지

## 🚀 예상 결과

개선 후에는 시간대별 운세가 다양하게 표현되어:
- 운이 좋은 날은 기본보다 20-30점 높게
- 보통인 날은 기본과 비슷하게
- 운이 나쁜 날은 기본보다 10-20점 낮게

더 현실적이고 다이나믹한 운세 표현이 가능해집니다.