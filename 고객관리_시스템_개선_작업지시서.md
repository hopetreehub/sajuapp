# ê³ ê°ê´€ë¦¬ ì‹œìŠ¤í…œ ê°œì„  ì‘ì—…ì§€ì‹œì„œ

## ğŸ“‹ ì‘ì—… ê°œìš”
- **ì‘ì„±ì¼**: 2025-09-16
- **ìš°ì„ ìˆœìœ„**: ğŸ”´ ë†’ìŒ
- **ì˜ˆìƒ ì†Œìš”ì‹œê°„**: 3-4ì‹œê°„
- **ê´€ë ¨ ì´ìŠˆ**: ê³ ê°ê´€ë¦¬ ìƒˆê³ ê°ë“±ë¡ ê¸°ëŠ¥ ë¹„ì •ìƒ ì‘ë™, ì‚¬ì£¼ë¶„ì„ ë©”ë‰´ UI ê°œì„  í•„ìš”

## ğŸ” í˜„ì¬ ë¬¸ì œì  ë¶„ì„

### 1. ì„¤ì • í˜ì´ì§€ ê³ ê°ê´€ë¦¬ íƒ­ ë¬¸ì œ
**ìœ„ì¹˜**: `packages/web/src/pages/SettingsPage.tsx`
- **ë¬¸ì œ**: ê³ ê°ê´€ë¦¬ íƒ­ì—ì„œ ìƒˆê³ ê°ë“±ë¡ ê¸°ëŠ¥ì´ ì •í™•íˆ ì‘ë™í•˜ì§€ ì•ŠìŒ
- **ì›ì¸ ì¶”ì •**:
  - ì„¤ì • í˜ì´ì§€ì™€ ê³ ê°ê´€ë¦¬ í˜ì´ì§€ ê°„ ë¼ìš°íŒ… ë¬¸ì œ
  - ì»´í¬ë„ŒíŠ¸ ìƒíƒœ ê´€ë¦¬ ë¶ˆì¼ì¹˜
  - í¼ ê²€ì¦ ë¡œì§ ì˜¤ë¥˜

### 2. ì‚¬ì£¼ë¶„ì„ í˜ì´ì§€ UI ë¬¸ì œ
**ìœ„ì¹˜**: `packages/web/src/pages/SajuAnalysisPage.tsx`
- **ë¬¸ì œ**: ê³ ê°ì„ íƒ ë©”ë‰´ ì˜†ì— ìƒˆê³ ê° ë“±ë¡ ë²„íŠ¼ ë¶€ì¬
- **í˜„ì¬ êµ¬ì¡°**:
  - UserSelectionPanel ì»´í¬ë„ŒíŠ¸ ì‚¬ìš© ì¤‘ (ìì²´ ì‚¬ìš©ì ì‹œìŠ¤í…œ)
  - CustomerSelector ì»´í¬ë„ŒíŠ¸ëŠ” ë³„ë„ë¡œ ì¡´ì¬í•˜ë‚˜ í†µí•©ë˜ì§€ ì•ŠìŒ
- **ê°œì„  í•„ìš”ì‚¬í•­**: ê³ ê° ì„ íƒê³¼ ìƒˆê³ ê° ë“±ë¡ì„ í•œ ê³³ì—ì„œ ì²˜ë¦¬

### 3. ë°ì´í„° íë¦„ ë¬¸ì œ
- **CustomerManagementPage**: ë…ë¦½ì ìœ¼ë¡œ ì‘ë™ (ì •ìƒ)
- **CustomerSelector**: ê³ ê° ì„ íƒë§Œ ê°€ëŠ¥ (ë“±ë¡ ê¸°ëŠ¥ ì—†ìŒ)
- **ì„¤ì • í˜ì´ì§€ ê³ ê°ê´€ë¦¬ íƒ­**: CustomerManagementPageì™€ ì—°ë™ ë¯¸í¡

## ğŸ¯ ê°œì„  ëª©í‘œ

### 1ë‹¨ê³„: CustomerSelector ì»´í¬ë„ŒíŠ¸ ê°œì„ 
- ê³ ê° ì„ íƒ ë“œë¡­ë‹¤ìš´ì— "â• ìƒˆ ê³ ê° ë“±ë¡" ë²„íŠ¼ ì¶”ê°€
- ìƒˆê³ ê° ë“±ë¡ ëª¨ë‹¬ í†µí•©
- ë“±ë¡ í›„ ìë™ ì„ íƒ ê¸°ëŠ¥

### 2ë‹¨ê³„: ì„¤ì • í˜ì´ì§€ ê³ ê°ê´€ë¦¬ íƒ­ ìˆ˜ì •
- CustomerManagementPage ì»´í¬ë„ŒíŠ¸ ì§ì ‘ ì„ë² ë“œ
- ë˜ëŠ” ë¼ìš°íŒ…ìœ¼ë¡œ ê³ ê°ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™
- íƒ­ ë‚´ì—ì„œ ì™„ì „í•œ CRUD ê¸°ëŠ¥ ì œê³µ

### 3ë‹¨ê³„: ì‚¬ì£¼ë¶„ì„ í˜ì´ì§€ UI ê°œì„ 
- CustomerSelectorë¥¼ ë©”ì¸ ì„ íƒ ë„êµ¬ë¡œ ë³€ê²½
- UserSelectionPanel ëŒ€ì‹  CustomerSelector ì‚¬ìš©
- ê³ ê° ë°ì´í„°ë¥¼ ì‚¬ì£¼ ë¶„ì„ ì…ë ¥ìœ¼ë¡œ ìë™ ë³€í™˜

## ğŸ“ êµ¬í˜„ ê³„íš

### 1. CustomerSelector ì»´í¬ë„ŒíŠ¸ í™•ì¥
```typescript
// packages/web/src/components/saju/CustomerSelector.tsx ìˆ˜ì •

interface CustomerSelectorProps {
  onSelect: (customer: Customer | null) => void;
  selectedCustomer: Customer | null;
  showAddButton?: boolean; // ìƒˆ ì†ì„± ì¶”ê°€
}

// ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì— ìƒˆê³ ê° ë“±ë¡ ëª¨ë‹¬ ì¶”ê°€
const [showAddModal, setShowAddModal] = useState(false);

// ë“œë¡­ë‹¤ìš´ì— ìƒˆê³ ê° ë“±ë¡ ë²„íŠ¼ ì¶”ê°€
<div className="p-2 border-b dark:border-gray-700">
  <button
    onClick={() => setShowAddModal(true)}
    className="w-full px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
  >
    â• ìƒˆ ê³ ê° ë“±ë¡
  </button>
</div>

// ìƒˆê³ ê° ë“±ë¡ ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸
{showAddModal && (
  <CustomerAddModal
    onClose={() => setShowAddModal(false)}
    onSuccess={(newCustomer) => {
      handleSelect(newCustomer);
      setShowAddModal(false);
      loadCustomers(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
    }}
  />
)}
```

### 2. CustomerAddModal ì»´í¬ë„ŒíŠ¸ ìƒì„±
```typescript
// packages/web/src/components/saju/CustomerAddModal.tsx (ìƒˆ íŒŒì¼)

import { useState } from 'react';
import { createCustomer, Customer } from '@/services/customerApi';

interface CustomerAddModalProps {
  onClose: () => void;
  onSuccess: (customer: Customer) => void;
}

export default function CustomerAddModal({ onClose, onSuccess }: CustomerAddModalProps) {
  // í¼ ìƒíƒœ ê´€ë¦¬
  // ìœ íš¨ì„± ê²€ì¦
  // API í˜¸ì¶œ
  // ì„±ê³µ/ì‹¤íŒ¨ ì²˜ë¦¬
}
```

### 3. SajuAnalysisPage ìˆ˜ì •
```typescript
// packages/web/src/pages/SajuAnalysisPage.tsx ìˆ˜ì •

import CustomerSelector from '@/components/saju/CustomerSelector';

// UserSelectionPanel ëŒ€ì‹  CustomerSelector ì‚¬ìš©
<div className="space-y-4">
  <CustomerSelector
    selectedCustomer={selectedCustomer}
    onSelect={handleCustomerSelect}
    showAddButton={true}
  />
</div>

// ê³ ê° ì„ íƒ í•¸ë“¤ëŸ¬
const handleCustomerSelect = (customer: Customer | null) => {
  if (customer) {
    // Customer ë°ì´í„°ë¥¼ SajuBirthInfoë¡œ ë³€í™˜
    const birthInfo: SajuBirthInfo = {
      year: parseInt(customer.birth_date.split('-')[0]),
      month: parseInt(customer.birth_date.split('-')[1]),
      day: parseInt(customer.birth_date.split('-')[2]),
      hour: parseInt(customer.birth_time.split(':')[0]),
      minute: parseInt(customer.birth_time.split(':')[1] || '0'),
      isLunar: customer.lunar_solar === 'lunar',
      gender: customer.gender,
    };
    setBirthInfo(birthInfo);
    analyzeSaju(birthInfo);
  }
};
```

### 4. ì„¤ì • í˜ì´ì§€ ê³ ê°ê´€ë¦¬ íƒ­ ê°œì„ 
```typescript
// packages/web/src/pages/SettingsPage.tsx ìˆ˜ì •

import CustomerManagementPage from './CustomerManagementPage';

// ê³ ê°ê´€ë¦¬ íƒ­ ë‚´ìš©
{activeTab === 'customers' && (
  <div className="space-y-6">
    <div className="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg">
      <p className="text-yellow-800 dark:text-yellow-200">
        ğŸ’¡ ê³ ê° ì •ë³´ë¥¼ ê´€ë¦¬í•˜ê³  ì‚¬ì£¼ ë¶„ì„ì— í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </p>
    </div>
    <CustomerManagementPage embedded={true} />
  </div>
)}
```

### 5. CustomerManagementPage ì„ë² ë“œ ëª¨ë“œ ì§€ì›
```typescript
// packages/web/src/pages/CustomerManagementPage.tsx ìˆ˜ì •

interface CustomerManagementPageProps {
  embedded?: boolean; // ì„¤ì • í˜ì´ì§€ ë‚´ ì„ë² ë“œ ì—¬ë¶€
}

export default function CustomerManagementPage({ embedded = false }: CustomerManagementPageProps) {
  // embedded ëª¨ë“œì¼ ë•Œ ë ˆì´ì•„ì›ƒ ì¡°ì •
  const containerClass = embedded
    ? "bg-white dark:bg-gray-800 rounded-lg p-6"
    : "min-h-screen bg-gray-50 dark:bg-gray-900 p-6";

  return (
    <div className={containerClass}>
      {/* ê¸°ì¡´ ì»¨í…ì¸  */}
    </div>
  );
}
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì‚¬ì£¼ë¶„ì„ í˜ì´ì§€ì—ì„œ ìƒˆê³ ê° ë“±ë¡
1. ì‚¬ì£¼ë¶„ì„ í˜ì´ì§€ ì ‘ì†
2. ê³ ê° ì„ íƒ ë“œë¡­ë‹¤ìš´ í´ë¦­
3. "â• ìƒˆ ê³ ê° ë“±ë¡" ë²„íŠ¼ í´ë¦­
4. ê³ ê° ì •ë³´ ì…ë ¥ í›„ ì €ì¥
5. ìë™ìœ¼ë¡œ í•´ë‹¹ ê³ ê° ì„ íƒë˜ê³  ì‚¬ì£¼ ë¶„ì„ ì‹œì‘

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì„¤ì • í˜ì´ì§€ ê³ ê°ê´€ë¦¬ íƒ­
1. ì„¤ì • í˜ì´ì§€ > ê³ ê°ê´€ë¦¬ íƒ­ ì´ë™
2. ê³ ê° ëª©ë¡ í™•ì¸
3. ìƒˆ ê³ ê° ë“±ë¡ ë²„íŠ¼ í´ë¦­
4. ì •ë³´ ì…ë ¥ ë° ì €ì¥
5. ëª©ë¡ì— ì¦‰ì‹œ ë°˜ì˜ í™•ì¸

### ì‹œë‚˜ë¦¬ì˜¤ 3: ê³ ê° ë°ì´í„° ë™ê¸°í™”
1. ê³ ê°ê´€ë¦¬ì—ì„œ ê³ ê° ì •ë³´ ìˆ˜ì •
2. ì‚¬ì£¼ë¶„ì„ í˜ì´ì§€ì—ì„œ í•´ë‹¹ ê³ ê° ì„ íƒ
3. ìˆ˜ì •ëœ ì •ë³´ê°€ ë°˜ì˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸

## ğŸ”§ ê¸°ìˆ ì  ê³ ë ¤ì‚¬í•­

### API í†µì‹ 
- Calendar Service (í¬íŠ¸ 5001)ì˜ `/api/calendar/customers` ì—”ë“œí¬ì¸íŠ¸ í™œìš©
- ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œë”© ìƒíƒœ ê´€ë¦¬
- ë‚™ê´€ì  ì—…ë°ì´íŠ¸ ì ìš©

### ìƒíƒœ ê´€ë¦¬
- ê³ ê° ëª©ë¡ ìºì‹± ì „ëµ
- ì„ íƒëœ ê³ ê° ì •ë³´ ì „ì—­ ìƒíƒœ ê´€ë¦¬ ê³ ë ¤
- React Query ë„ì… ê²€í† 

### UI/UX
- ëª¨ë‹¬ ì ‘ê·¼ì„± (í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜, ESC ë‹«ê¸°)
- í¼ ìœ íš¨ì„± ê²€ì¦ ì‹¤ì‹œê°„ í”¼ë“œë°±
- ë¡œë”© ë° ì—ëŸ¬ ìƒíƒœ ì‹œê°í™”
- ëª¨ë°”ì¼ ë°˜ì‘í˜• ë””ìì¸

### ë°ì´í„° ë³€í™˜
- Customer â†” SajuBirthInfo ë³€í™˜ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
- ìŒë ¥/ì–‘ë ¥ ë³€í™˜ ì²˜ë¦¬
- ì‹œê°„ í˜•ì‹ í†µì¼ (24ì‹œê°„ì œ)

## ğŸ“Š ì™„ë£Œ ê¸°ì¤€

### í•„ìˆ˜ ìš”êµ¬ì‚¬í•­
- [ ] CustomerSelectorì— ìƒˆê³ ê° ë“±ë¡ ë²„íŠ¼ ë° ëª¨ë‹¬ ì¶”ê°€
- [ ] ì‚¬ì£¼ë¶„ì„ í˜ì´ì§€ì—ì„œ ê³ ê° ì„ íƒ ë° ë“±ë¡ ê°€ëŠ¥
- [ ] ì„¤ì • í˜ì´ì§€ ê³ ê°ê´€ë¦¬ íƒ­ì—ì„œ ì™„ì „í•œ CRUD ê¸°ëŠ¥
- [ ] ë“±ë¡ëœ ê³ ê° ì •ë³´ë¡œ ì‚¬ì£¼ ë¶„ì„ ìë™ ì‹¤í–‰
- [ ] ëª¨ë“  í˜ì´ì§€ì—ì„œ ê³ ê° ë°ì´í„° ë™ê¸°í™”

### í’ˆì§ˆ ê¸°ì¤€
- [ ] TypeScript íƒ€ì… ì—ëŸ¬ ì—†ìŒ
- [ ] ESLint ê²½ê³ /ì—ëŸ¬ í•´ê²°
- [ ] 3ê°€ì§€ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ í†µê³¼
- [ ] ë¸Œë¼ìš°ì € ì½˜ì†” ì—ëŸ¬ ì—†ìŒ
- [ ] ëª¨ë°”ì¼ ë°˜ì‘í˜• UI ì •ìƒ ì‘ë™

## ğŸš€ ì‹¤í–‰ ëª…ë ¹ì–´

### ê°œë°œ ì„œë²„ ì‹¤í–‰
```bash
# í”„ë¡ íŠ¸ì—”ë“œ (í¬íŠ¸ 4000)
cd packages/web && npm run dev

# Calendar Service (í¬íŠ¸ 5001) - ê³ ê° ë°ì´í„° API
cd packages/backend/services/calendar && npm run dev
```

### í…ŒìŠ¤íŠ¸
```bash
# ë¸Œë¼ìš°ì €ì—ì„œ í…ŒìŠ¤íŠ¸
1. http://localhost:4000/settings (ì„¤ì • í˜ì´ì§€ ê³ ê°ê´€ë¦¬ íƒ­)
2. http://localhost:4000/saju (ì‚¬ì£¼ë¶„ì„ í˜ì´ì§€)
3. http://localhost:4000/customers (ê³ ê°ê´€ë¦¬ ì „ìš© í˜ì´ì§€)
```

## ğŸ“ ì°¸ê³  ë¬¸ì„œ
- Customer API: `packages/web/src/services/customerApi.ts`
- Customer íƒ€ì… ì •ì˜: `packages/web/src/types/customer.ts`
- ì‚¬ì£¼ íƒ€ì… ì •ì˜: `packages/web/src/types/saju.ts`
- ê¸°ì¡´ ê³ ê°ê´€ë¦¬ í˜ì´ì§€: `packages/web/src/pages/CustomerManagementPage.tsx`

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ë°ì´í„° ë¬´ê²°ì„±**
   - ê³ ê° ì‚­ì œ ì‹œ ê´€ë ¨ ë¶„ì„ ë°ì´í„° ì²˜ë¦¬ ë°©ì•ˆ ê²€í† 
   - ì¤‘ë³µ ê³ ê° ë“±ë¡ ë°©ì§€ (ì´ë¦„+ìƒë…„ì›”ì¼)

2. **ì„±ëŠ¥ ìµœì í™”**
   - ê³ ê° ëª©ë¡ì´ ë§ì„ ê²½ìš° í˜ì´ì§€ë„¤ì´ì…˜ í•„ìˆ˜
   - ê²€ìƒ‰ ë””ë°”ìš´ì‹± ì ìš© (300ms)

3. **ë³´ì•ˆ ê³ ë ¤ì‚¬í•­**
   - ê°œì¸ì •ë³´ ë…¸ì¶œ ìµœì†Œí™”
   - XSS ë°©ì§€ë¥¼ ìœ„í•œ ì…ë ¥ê°’ ê²€ì¦

4. **í•˜ìœ„ í˜¸í™˜ì„±**
   - ê¸°ì¡´ UserSelectionPanel ì‚¬ìš© ë¶€ë¶„ê³¼ ì¶©ëŒ ë°©ì§€
   - localStorage ë°ì´í„°ì™€ DB ë°ì´í„° ë™ê¸°í™”

---

*ì´ ì‘ì—…ì§€ì‹œì„œëŠ” ê³ ê°ê´€ë¦¬ ì‹œìŠ¤í…œì˜ í†µí•©ì„±ê³¼ ì‚¬ìš©ì„±ì„ ê°œì„ í•˜ê¸° ìœ„í•œ ì¢…í•©ì ì¸ ê°€ì´ë“œì…ë‹ˆë‹¤.*