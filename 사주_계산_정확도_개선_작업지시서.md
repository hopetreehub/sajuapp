# ì‚¬ì£¼ ê³„ì‚° ì •í™•ë„ ê°œì„  ì‘ì—…ì§€ì‹œì„œ

## ğŸš¨ ë¬¸ì œ ìƒí™© ë¶„ì„

### ë°œê²¬ëœ ì˜¤ë¥˜
- **í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤**: 1971ë…„ 11ì›” 17ì¼ 04ì‹œ ì–‘ë ¥
- **ì˜¬ë°”ë¥¸ ì‚¬ì£¼**: ì‹ í•´ ê¸°í•´ ë³‘ì˜¤ ê²½ì¸ âœ…
- **í˜„ì¬ DB ì €ì¥ëœ ì˜ëª»ëœ ì‚¬ì£¼**: ì‹ í•´ ê²½ì ì„ë¯¸ ë¬´ì¸ âŒ

### ì˜¤ë¥˜ ì›ì¸ ë¶„ì„
1. **ì •í™•í•œ ê³„ì‚°ê¸° ì¡´ì¬**: `accurateSajuCalculator.ts`ê°€ ì˜¬ë°”ë¥¸ ê²°ê³¼ ê³„ì‚°
2. **êµ¬í˜„ ìƒíƒœ**: Backendì—ì„œ ì´ë¯¸ ì •í™•í•œ ê³„ì‚°ê¸°ë¥¼ importí•˜ê³  ìˆìŒ
3. **ì¶”ì • ì›ì¸**: ê¸°ì¡´ DB ë°ì´í„°ê°€ ì´ì „ ë²„ì „ì˜ ë¶€ì •í™•í•œ ê³„ì‚°ê¸°ë¡œ ì €ì¥ë¨

## âœ… í™•ì¸ëœ ì‚¬ì‹¤ë“¤

### ğŸ¯ ì •í™•í•œ ê³„ì‚°ê¸° í…ŒìŠ¤íŠ¸ ê²°ê³¼
```bash
# í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²°ê³¼
cd packages/backend/services/calendar
node -e "
const { calculateCompleteSaju } = require('./dist/utils/accurateSajuCalculator.js');
const result = calculateCompleteSaju(1971, 11, 17, 4, 0, false);
console.log('ì „ì²´ ì‚¬ì£¼:', result.fullSaju);
"

# ì¶œë ¥: ì‹ í•´ ê¸°í•´ ë³‘ì˜¤ ê²½ì¸ âœ… (ì •í™•í•¨)
```

### ğŸ”§ í˜„ì¬ ì‹œìŠ¤í…œ ìƒíƒœ
1. **ë°±ì—”ë“œ**: ì •í™•í•œ ê³„ì‚°ê¸° ì´ë¯¸ ì ìš© ì™„ë£Œ
2. **API**: `/api/calendar/customers` ì •ìƒ ì‘ë™
3. **í”„ë¡ íŠ¸ì—”ë“œ**: í¬íŠ¸ 4001ì—ì„œ ì •ìƒ ì‹¤í–‰
4. **ë°ì´í„° ë¬¸ì œ**: ê¸°ì¡´ DBì˜ ë¶€ì •í™•í•œ ì‚¬ì£¼ ë°ì´í„°

## ğŸ“‹ í•´ê²° ë°©ì•ˆ

### 1ë‹¨ê³„: ê¸°ì¡´ ê³ ê° ì‚¬ì£¼ ë°ì´í„° ì¬ê³„ì‚° ë° ì—…ë°ì´íŠ¸

#### 1.1 ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
```bash
# customers.db ë°±ì—… ìƒì„±
cd packages/backend/services/calendar/customer
cp customers.db customers_backup_$(date +%Y%m%d_%H%M%S).db
```

#### 1.2 ì‚¬ì£¼ ì¬ê³„ì‚° ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
```javascript
// recalculate-saju-data.js
const Database = require('better-sqlite3');
const { calculateCompleteSaju } = require('../dist/utils/accurateSajuCalculator.js');

const db = new Database('./customer/customers.db');

// ëª¨ë“  ê³ ê° ë°ì´í„° ì¡°íšŒ
const customers = db.prepare('SELECT * FROM customers').all();

console.log(`ì´ ${customers.length}ëª…ì˜ ê³ ê° ì‚¬ì£¼ ì¬ê³„ì‚° ì‹œì‘...`);

for (const customer of customers) {
  try {
    // ìƒë…„ì›”ì¼ì‹œ íŒŒì‹±
    const [year, month, day] = customer.birth_date.split('-').map(Number);
    const [hour, minute] = customer.birth_time.split(':').map(Number);
    const isLunar = customer.lunar_solar === 'lunar';
    
    // ì •í™•í•œ ì‚¬ì£¼ ê³„ì‚°
    const accurateSaju = calculateCompleteSaju(year, month, day, hour, minute, isLunar);
    
    // ê¸°ì¡´ ë°ì´í„°ì™€ ë¹„êµ
    const oldSaju = JSON.parse(customer.saju_data || '{}');
    const newSajuText = accurateSaju.fullSaju;
    const oldSajuText = oldSaju.fullSaju || 'N/A';
    
    if (newSajuText !== oldSajuText) {
      console.log(`ğŸ”„ ${customer.name}: ${oldSajuText} â†’ ${newSajuText}`);
      
      // ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸
      db.prepare(`
        UPDATE customers 
        SET saju_data = ?, updated_at = CURRENT_TIMESTAMP 
        WHERE id = ?
      `).run(JSON.stringify(accurateSaju), customer.id);
    } else {
      console.log(`âœ… ${customer.name}: ì´ë¯¸ ì •í™•í•¨`);
    }
    
  } catch (error) {
    console.error(`âŒ ${customer.name} ê³„ì‚° ì‹¤íŒ¨:`, error.message);
  }
}

console.log('ì‚¬ì£¼ ì¬ê³„ì‚° ì™„ë£Œ!');
db.close();
```

#### 1.3 ì¬ê³„ì‚° ì‹¤í–‰
```bash
cd packages/backend/services/calendar
node recalculate-saju-data.js
```

### 2ë‹¨ê³„: ì‹ ê·œ ê³ ê° ë“±ë¡ ì‹œ ì •í™•í•œ ê³„ì‚°ê¸° ì ìš© í™•ì¸

#### 2.1 Customer API ì ê²€
```typescript
// customers.tsì—ì„œ í™•ì¸ í•„ìš”
import { calculateCompleteSaju } from '../utils/accurateSajuCalculator'; // âœ… ì´ë¯¸ ì ìš©ë¨
```

#### 2.2 API í…ŒìŠ¤íŠ¸
```bash
# ì‹ ê·œ ê³ ê° ë“±ë¡ í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:4003/api/calendar/customers \
  -H "Content-Type: application/json" \
  -d '{
    "name": "í…ŒìŠ¤íŠ¸ì‚¬ìš©ì",
    "birth_date": "1971-11-17",
    "birth_time": "04:00",
    "lunar_solar": "solar",
    "gender": "male",
    "phone": "010-0000-0000"
  }'

# ê²°ê³¼ í™•ì¸: ì‹ í•´ ê¸°í•´ ë³‘ì˜¤ ê²½ì¸ì´ ë‚˜ì™€ì•¼ í•¨
```

### 3ë‹¨ê³„: í”„ë¡ íŠ¸ì—”ë“œ ì‚¬ì£¼ í‘œì‹œ ê²€ì¦

#### 3.1 UnifiedSajuAnalysisPage í…ŒìŠ¤íŠ¸
1. ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:4001 ì ‘ì†
2. ì‚¬ì£¼ ë¶„ì„ í˜ì´ì§€ ì´ë™
3. 1971.11.17.04ì‹œ ê³ ê° ì„ íƒ
4. **ì˜ˆìƒ ê²°ê³¼**: ì‹ í•´ ê¸°í•´ ë³‘ì˜¤ ê²½ì¸ í‘œì‹œ âœ…
5. **ê¸°ì¡´ ì˜ëª»ëœ ê²°ê³¼**: ì‹ í•´ ê²½ì ì„ë¯¸ ë¬´ì¸ âŒ

#### 3.2 ê³ ê° ê´€ë¦¬ í˜ì´ì§€ í™•ì¸
1. ê³ ê° ê´€ë¦¬ í˜ì´ì§€ ì ‘ì†
2. ëª¨ë“  ê³ ê°ì˜ ì‚¬ì£¼ ë°ì´í„° ì •í™•ì„± í™•ì¸
3. ì‚¬ì£¼ ì°¨íŠ¸ ì‹œê°í™” ì •í™•ì„± ê²€ì¦

## ğŸ”¥ ì¦‰ì‹œ ì‹¤í–‰ ë‹¨ê³„

### Phase 1: ê¸´ê¸‰ ë°ì´í„° ìˆ˜ì • (15ë¶„)
```bash
# 1. DB ë°±ì—…
cd packages/backend/services/calendar
cp customer/customers.db customer/customers_backup.db

# 2. ì¬ê³„ì‚° ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ë° ì‹¤í–‰
# (ìœ„ì˜ recalculate-saju-data.js ìŠ¤í¬ë¦½íŠ¸ ìƒì„±)
node recalculate-saju-data.js
```

### Phase 2: ì‹œìŠ¤í…œ ì¬ì‹œì‘ ë° ê²€ì¦ (10ë¶„)
```bash
# 1. ë°±ì—”ë“œ ì„œë¹„ìŠ¤ ì¬ì‹œì‘
# (í˜„ì¬ ì‹¤í–‰ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ë“¤ í™•ì¸ í›„ ì¬ì‹œì‘)

# 2. API í…ŒìŠ¤íŠ¸
curl http://localhost:4003/api/calendar/customers?page=1&limit=5

# 3. í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì‚¬ì£¼ ë°ì´í„° í™•ì¸
# http://localhost:4001ì—ì„œ ê³ ê° ì„ íƒí•˜ì—¬ ì‚¬ì£¼ ì •í™•ì„± í™•ì¸
```

### Phase 3: ì „ì²´ ì‹œìŠ¤í…œ ê²€ì¦ (10ë¶„)
1. **ëª¨ë“  ê³ ê° ë°ì´í„° ì ê²€**: 6ëª… ëª¨ë“  ê³ ê°ì˜ ì‚¬ì£¼ ì •í™•ì„± ê²€ì¦
2. **ì°¨íŠ¸ ì‹œê°í™” í™•ì¸**: UnifiedSajuRadarChartì—ì„œ ì˜¬ë°”ë¥¸ ë°ì´í„° í‘œì‹œ í™•ì¸
3. **ì˜¤í–‰ê· í˜•ë„ ê²€ì¦**: ì •í™•í•œ ì˜¤í–‰ ë¹„ìœ¨ ê³„ì‚° í™•ì¸

## ğŸ“Š ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

### âœ… í•„ìˆ˜ í™•ì¸ ì‚¬í•­
- [ ] 1971.11.17.04ì‹œ â†’ ì‹ í•´ ê¸°í•´ ë³‘ì˜¤ ê²½ì¸ ì •í™• í‘œì‹œ
- [ ] ëª¨ë“  ê¸°ì¡´ ê³ ê° ì‚¬ì£¼ ë°ì´í„° ì •í™•ì„± í™•ì¸
- [ ] ì‹ ê·œ ê³ ê° ë“±ë¡ ì‹œ ì •í™•í•œ ì‚¬ì£¼ ê³„ì‚° í™•ì¸
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ì°¨íŠ¸ì—ì„œ ì˜¬ë°”ë¥¸ ì‚¬ì£¼ í‘œì‹œ í™•ì¸
- [ ] ì˜¤í–‰ê· í˜•ë„ ì •í™•ì„± ê²€ì¦
- [ ] API ì‘ë‹µì—ì„œ ì •í™•í•œ ì‚¬ì£¼ ë°ì´í„° í™•ì¸

### ğŸ¯ ì„±ê³µ ì§€í‘œ
- **ì •í™•ë„**: ëª¨ë“  ì‚¬ì£¼ ê³„ì‚° 100% ì •í™•
- **ë°ì´í„° ì¼ê´€ì„±**: DB-API-í”„ë¡ íŠ¸ì—”ë“œ ëª¨ë“  ë ˆì´ì–´ì—ì„œ ë™ì¼í•œ ì‚¬ì£¼ í‘œì‹œ
- **ì‚¬ìš©ì ê²½í—˜**: ì •í™•í•œ ì‚¬ì£¼ ë¶„ì„ ì •ë³´ ì œê³µ

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ë°ì´í„° ë°±ì—… í•„ìˆ˜**: customers.db ë°˜ë“œì‹œ ë°±ì—… í›„ ì§„í–‰
2. **ë‹¨ê³„ì  ê²€ì¦**: ê° ë‹¨ê³„ë§ˆë‹¤ ê²°ê³¼ í™•ì¸ í›„ ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰
3. **ë¡¤ë°± ì¤€ë¹„**: ë¬¸ì œ ë°œìƒ ì‹œ ë°±ì—… DBë¡œ ì¦‰ì‹œ ë³µêµ¬ ê°€ëŠ¥í•˜ë„ë¡ ì¤€ë¹„
4. **í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ í™•ë³´**: 1971.11.17.04ì‹œ ì™¸ ì¶”ê°€ ê²€ì¦ ì¼€ì´ìŠ¤ ì¤€ë¹„

---
**ì‘ì„±ì¼**: 2025-01-03  
**ìš°ì„ ìˆœìœ„**: ğŸ”¥ ê¸´ê¸‰ (ì‚¬ì£¼ ì •í™•ë„ëŠ” ì•±ì˜ í•µì‹¬ ê°€ì¹˜)  
**ì˜ˆìƒ ì†Œìš”ì‹œê°„**: 35ë¶„  
**ë‹´ë‹¹**: Backend + Frontend í†µí•© ê²€ì¦ í•„ìš”