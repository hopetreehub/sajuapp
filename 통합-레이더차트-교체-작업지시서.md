# 통합 레이더차트 교체 작업지시서

## 📋 프로젝트 개요
현재 존재하는 6대 영역, 17대 세부운세, 7대 성향 레이더차트를 모두 제거하고, 주문차트.pdf의 11개 대항목 구조로 통일된 레이더차트 시스템으로 교체합니다.

## 🎯 작업 목적
1. **기존 차트 제거**: 6대/17대/7대 성향 관련 모든 컴포넌트 삭제
2. **통일된 구조**: 주문차트.pdf 기반 11개 대항목으로 통일
3. **일관된 디자인**: 동일한 위치, 모양, 스타일 적용
4. **단계별 구현**: 체계적이고 안전한 교체 작업

## 🔍 현재 시스템 분석 결과

### 기존 차트 컴포넌트 현황
1. **SixAreaChart.tsx** - 6대 영역 (근본, 사고, 인연, 행동, 행운, 환경)
2. **SeventeenFortuneChart.tsx** - 17대 세부운세 (건강운, 결혼운, 권력운 등)
3. **PersonalityAnalysisChart.tsx** - 7대 성향 (감성, 논리성, 예술성, 이성, 인성, 지성, 학습성)

### 공통 기술 스택 확인
- **차트 라이브러리**: Chart.js + react-chartjs-2
- **차트 타입**: Radar Chart
- **공통 훅**: useStandardRadarChart.ts
- **디자인 시스템**: CHART_DESIGN_SYSTEM
- **시간대 기능**: 기본/오늘/이달/올해 선택

### 기존 레이아웃 구조
```typescript
// 공통 레이아웃 구조
<div className={CHART_DESIGN_SYSTEM.LAYOUT.chartContainer.wrapper}>
  {/* 헤더 */}
  <div className="mb-6">
    <h3>차트 제목</h3>
  </div>
  
  {/* 레이더차트 - 통일된 높이 */}
  <div style={{ height: CHART_DESIGN_SYSTEM.DIMENSIONS.height }}>
    <Radar data={chartData} options={options} />
  </div>
  
  {/* 시간대 선택 버튼 */}
  <div className={CHART_DESIGN_SYSTEM.LAYOUT.timeFrameSelector.container}>
    ...
  </div>
  
  {/* 점수 카드 */}
  <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
    ...
  </div>
</div>
```

## 🏗️ 구현 계획

### Phase 1: 새로운 통합 레이더차트 컴포넌트 생성
**작업 기간**: 2일

#### 1.1 데이터 구조 정의
```typescript
// src/types/sajuRadar.ts
export interface SajuRadarCategory {
  id: string
  name: string
  icon: string
  description: string
  subcategories: SajuSubcategory[]
}

export interface SajuSubcategory {
  id: string
  name: string
  items: SajuRadarItem[]
}

export interface SajuRadarItem {
  id: string
  name: string
  baseScore: number
  timeFrameScores?: {
    today?: number
    month?: number
    year?: number
  }
}

export interface SajuRadarData {
  categoryId: string
  subcategoryId: string
  title: string
  items: SajuRadarItem[]
  chartData: number[]
  maxValue: number
}
```

#### 1.2 11개 대항목 데이터 정의
```typescript
// src/data/sajuRadarData.ts
export const SAJU_RADAR_CATEGORIES: SajuRadarCategory[] = [
  {
    id: 'jubon',
    name: '주본',
    icon: '🎯',
    description: '기본 성향과 본성 분석',
    subcategories: [
      {
        id: 'personality',
        name: '성격',
        items: [
          { id: 'active', name: '적극성', baseScore: 75 },
          { id: 'passive', name: '소극성', baseScore: 45 },
          { id: 'extrovert', name: '외향성', baseScore: 80 },
          // ... PDF에서 추출된 모든 세부항목
        ]
      },
      {
        id: 'temperament',
        name: '기질',
        items: [
          { id: 'calm', name: '침착함', baseScore: 70 },
          { id: 'hasty', name: '급성', baseScore: 40 },
          // ... 기질 관련 세부항목들
        ]
      }
      // ... 주본의 다른 중항목들
    ]
  },
  // ... 나머지 10개 대항목 (주운, 뇌, 주건, 주연, 주재, 주업, 주물, 주생, 주능, 주흉)
]
```

#### 1.3 통합 레이더차트 컴포넌트
```typescript
// src/components/saju/charts/UnifiedSajuRadarChart.tsx
interface UnifiedSajuRadarChartProps {
  selectedCategory: string
  selectedSubcategory: string
  birthDate?: string
  sajuData?: any
}

export default function UnifiedSajuRadarChart({
  selectedCategory,
  selectedSubcategory,
  birthDate,
  sajuData
}: UnifiedSajuRadarChartProps) {
  const [selectedTimeFrame, setSelectedTimeFrame] = useState<TimeFrame>('base')
  const [isDarkMode, setIsDarkMode] = useState(false)
  
  // 기존 차트와 동일한 로직 적용
  // - useStandardRadarChart 훅 활용
  // - CHART_DESIGN_SYSTEM 스타일 적용
  // - 동일한 레이아웃 구조 유지
  
  return (
    <div className={CHART_DESIGN_SYSTEM.LAYOUT.chartContainer.wrapper}>
      {/* 기존과 동일한 구조로 구현 */}
    </div>
  )
}
```

### Phase 2: 네비게이션 및 선택 시스템
**작업 기간**: 1일

#### 2.1 대항목 네비게이션
```typescript
// src/components/saju/SajuCategoryNavigation.tsx
interface CategoryNavigationProps {
  categories: SajuRadarCategory[]
  selectedCategory: string
  onCategoryChange: (categoryId: string) => void
}

export default function SajuCategoryNavigation({
  categories,
  selectedCategory,
  onCategoryChange
}: CategoryNavigationProps) {
  return (
    <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-8">
      {categories.map(category => (
        <button
          key={category.id}
          onClick={() => onCategoryChange(category.id)}
          className={`p-4 rounded-xl border-2 transition-all duration-200 ${
            selectedCategory === category.id
              ? 'border-purple-500 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300'
              : 'border-gray-200 hover:border-purple-300 hover:bg-purple-50 dark:hover:bg-purple-900/10'
          }`}
        >
          <div className="text-3xl mb-2">{category.icon}</div>
          <h3 className="font-bold text-lg">{category.name}</h3>
          <p className="text-sm text-gray-600 dark:text-gray-400 mt-1">
            {category.description}
          </p>
        </button>
      ))}
    </div>
  )
}
```

#### 2.2 중항목 탭 선택
```typescript
// src/components/saju/SajuSubcategoryTabs.tsx
interface SubcategoryTabsProps {
  subcategories: SajuSubcategory[]
  selectedSubcategory: string
  onSubcategoryChange: (subcategoryId: string) => void
}

export default function SajuSubcategoryTabs({
  subcategories,
  selectedSubcategory,
  onSubcategoryChange
}: SubcategoryTabsProps) {
  return (
    <div className="flex overflow-x-auto gap-2 mb-6">
      {subcategories.map(sub => (
        <button
          key={sub.id}
          onClick={() => onSubcategoryChange(sub.id)}
          className={`px-4 py-2 rounded-lg whitespace-nowrap transition-colors ${
            selectedSubcategory === sub.id
              ? 'bg-purple-500 text-white'
              : 'bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600'
          }`}
        >
          {sub.name}
        </button>
      ))}
    </div>
  )
}
```

### Phase 3: 메인 페이지 통합
**작업 기간**: 1일

#### 3.1 새로운 사주 레이더 페이지
```typescript
// src/pages/SajuRadarPage.tsx
export default function SajuRadarPage() {
  const [selectedCategory, setSelectedCategory] = useState('jubon')
  const [selectedSubcategory, setSelectedSubcategory] = useState('')
  
  const currentCategory = SAJU_RADAR_CATEGORIES.find(cat => cat.id === selectedCategory)
  
  // 카테고리 변경 시 첫 번째 중항목 자동 선택
  useEffect(() => {
    if (currentCategory && currentCategory.subcategories.length > 0) {
      setSelectedSubcategory(currentCategory.subcategories[0].id)
    }
  }, [selectedCategory, currentCategory])
  
  return (
    <div className="min-h-screen bg-gray-50 dark:bg-gray-900">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* 헤더 */}
        <div className="text-center mb-8">
          <h1 className="text-3xl font-bold text-gray-900 dark:text-white mb-2">
            🔮 사주 레이더 분석
          </h1>
          <p className="text-gray-600 dark:text-gray-400">
            주문차트 기반 상세 사주 분석 시스템
          </p>
        </div>
        
        {/* 대항목 네비게이션 */}
        <SajuCategoryNavigation
          categories={SAJU_RADAR_CATEGORIES}
          selectedCategory={selectedCategory}
          onCategoryChange={setSelectedCategory}
        />
        
        {/* 중항목 탭 */}
        {currentCategory && (
          <SajuSubcategoryTabs
            subcategories={currentCategory.subcategories}
            selectedSubcategory={selectedSubcategory}
            onSubcategoryChange={setSelectedSubcategory}
          />
        )}
        
        {/* 통합 레이더차트 */}
        <UnifiedSajuRadarChart
          selectedCategory={selectedCategory}
          selectedSubcategory={selectedSubcategory}
        />
      </div>
    </div>
  )
}
```

### Phase 4: 기존 차트 제거 및 교체
**작업 기간**: 0.5일

#### 4.1 기존 컴포넌트 제거 목록
```bash
# 제거할 파일들
rm packages/web/src/components/saju/charts/SixAreaChart.tsx
rm packages/web/src/components/saju/charts/SeventeenFortuneChart.tsx
rm packages/web/src/components/saju/charts/PersonalityAnalysisChart.tsx

# 관련 타입 정리
# packages/web/src/types/saju.ts에서 기존 타입 제거
```

#### 4.2 라우팅 및 메뉴 교체
```typescript
// src/App.tsx에서 라우트 교체
// 기존: /saju → 새로운: /saju-radar
<Route path="/saju" element={<SajuRadarPage />} />

// Header.tsx에서 메뉴 업데이트
const navItems = [
  // ... 기존 메뉴들
  { path: '/saju', label: '사주분석', icon: '🔮' }, // 아이콘 변경
  // ...
]
```

#### 4.3 기존 페이지에서 새 컴포넌트로 교체
```typescript
// 기존 사주 페이지에서 차트 컴포넌트들을 새로운 통합 시스템으로 교체
// SixAreaChart → UnifiedSajuRadarChart (jubon 카테고리)
// SeventeenFortuneChart → UnifiedSajuRadarChart (주운 카테고리)
// PersonalityAnalysisChart → UnifiedSajuRadarChart (주본 카테고리)
```

## 🛠️ 기술적 구현 세부사항

### 1. 기존 디자인 시스템 재활용
```typescript
// 기존 CHART_DESIGN_SYSTEM 모든 요소 그대로 사용
import { CHART_DESIGN_SYSTEM, getTimeFrameColors, getChartOptions } from '@/constants/chartDesignSystem'

// 동일한 높이, 색상, 버튼 스타일 적용
height: CHART_DESIGN_SYSTEM.DIMENSIONS.height
className: CHART_DESIGN_SYSTEM.LAYOUT.chartContainer.wrapper
```

### 2. 시간대 기능 통일
```typescript
// 모든 차트에서 동일한 시간대 기능 제공
const timeFrames = ['base', 'today', 'month', 'year']
const timeFrameColors = {
  base: getTimeFrameColors('base'),
  today: getTimeFrameColors('today'),
  month: getTimeFrameColors('month'),
  year: getTimeFrameColors('year')
}
```

### 3. 차트 데이터 생성 로직 통일
```typescript
// 모든 차트에서 동일한 점수 생성 알고리즘 사용
const generateTimeBasedScore = (
  baseScore: number,
  timeFrame: TimeFrame,
  weights: TimeFrameWeights
): number => {
  // 기존 차트들과 동일한 로직 적용
  const weight = weights[timeFrame] || 1.0
  const variance = timeFrame === 'today' ? 25 : timeFrame === 'month' ? 18 : 12
  const adjustedBase = baseScore * 0.8
  const weightedScore = adjustedBase * weight
  const randomVariance = (Math.random() - 0.5) * variance
  const finalScore = weightedScore + randomVariance
  return Math.max(20, Math.min(85, Math.round(finalScore)))
}
```

## 📝 단계별 체크리스트

### Phase 1 완료 기준
- [ ] SajuRadarCategory 타입 정의 완료
- [ ] 11개 대항목 데이터 구조 완료
- [ ] UnifiedSajuRadarChart 컴포넌트 구현 완료
- [ ] 기존 차트와 동일한 스타일/레이아웃 적용 확인

### Phase 2 완료 기준
- [ ] SajuCategoryNavigation 컴포넌트 구현 완료
- [ ] SajuSubcategoryTabs 컴포넌트 구현 완료
- [ ] 네비게이션 상태 관리 완료
- [ ] 반응형 디자인 적용 확인

### Phase 3 완료 기준
- [ ] SajuRadarPage 메인 페이지 구현 완료
- [ ] 컴포넌트 간 상태 연동 완료
- [ ] 라우팅 설정 완료
- [ ] 전체 페이지 통합 테스트 완료

### Phase 4 완료 기준
- [ ] 기존 차트 컴포넌트 완전 제거 확인
- [ ] 새로운 통합 시스템으로 교체 완료
- [ ] 메뉴 및 라우팅 업데이트 완료
- [ ] 전체 시스템 동작 테스트 완료

## 🎯 핵심 원칙

### 1. 완전한 일관성 유지
- **동일한 높이**: `CHART_DESIGN_SYSTEM.DIMENSIONS.height`
- **동일한 색상**: `getTimeFrameColors()` 함수 사용
- **동일한 레이아웃**: 기존 wrapper 클래스 적용
- **동일한 버튼**: `BUTTON_STYLES.timeFrame` 스타일 사용

### 2. 기존 기능 100% 보존
- **시간대 선택**: 기본/오늘/이달/올해 모든 기능 유지
- **다크모드**: MutationObserver 기반 실시간 감지 유지
- **인터랙티브**: 툴팁, 호버 효과 모든 기능 유지
- **반응형**: 모바일/데스크톱 반응형 디자인 유지

### 3. 점진적 교체 방식
- **안전한 구현**: 새 시스템 완성 후 기존 시스템 제거
- **테스트 우선**: 각 단계별 충분한 테스트 후 진행
- **백업 보존**: 기존 컴포넌트 백업 후 제거 진행

## 🚀 배포 전 최종 검증사항

1. **기능적 동일성**
   - [ ] 모든 차트가 동일한 높이로 렌더링
   - [ ] 시간대 버튼이 동일한 위치와 스타일
   - [ ] 점수 카드가 동일한 그리드 레이아웃
   - [ ] 다크모드 전환 시 모든 요소 정상 동작

2. **데이터 정확성**
   - [ ] 11개 대항목 모든 데이터 정상 표시
   - [ ] 중항목별 세부 항목 정확한 매핑
   - [ ] 시간대별 점수 변화 로직 정상 동작
   - [ ] 차트 애니메이션 부드러운 전환

3. **사용자 경험**
   - [ ] 카테고리 전환 시 즉시 반영
   - [ ] 중항목 탭 전환 시 차트 업데이트
   - [ ] 모든 인터랙션 자연스러운 반응
   - [ ] 로딩 상태 적절한 처리

---

*이 작업지시서는 기존 6대/17대/7대 성향 차트를 주문차트.pdf 기반 11개 대항목 통합 시스템으로 완전 교체하기 위한 상세 가이드입니다.*