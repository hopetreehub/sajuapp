# 🎯 운명나침반 차기 단계 통합 작업지시서

## 📋 작업 개요

**프로젝트명**: 운명나침반(Fortune Compass) - 사주 운세 시스템 고도화
**작업 일정**: 2025년 9월 21일 ~ 9월 23일 (3일간)
**작업 목표**: 핵심 기능 복원 및 개인차 알고리즘 강화
**PM 승인**: ✅ 승인 완료

## 👥 전문가 페르소나 구성

### 1. 🎨 **UX/UI 디자이너** - Sarah Kim
- **역할**: 시각적 차별화와 직관성 강화
- **집중 영역**: 주능/주흉 시각화, 차트 가독성 개선
- **핵심 가치**: "한 눈에 파악되는 운세 정보"

### 2. 🔮 **사주학 전문가** - Master Lee
- **역할**: 사주학적 정확성 검증 및 알고리즘 정밀화
- **집중 영역**: 용신 효과 강화, 격국별 차별화
- **핵심 가치**: "천년 전통의 정통 사주학 구현"

### 3. 💻 **시니어 백엔드 개발자** - David Park
- **역할**: 서비스 안정성 및 성능 최적화
- **집중 영역**: 마이크로서비스 연동, API 최적화
- **핵심 가치**: "초당 만 건 처리 가능한 확장성"

### 4. 🧪 **데이터 사이언티스트** - Dr. Chen
- **역할**: 통계적 검증과 알고리즘 개선
- **집중 영역**: 개인차 점수 분포 최적화
- **핵심 가치**: "통계적으로 유의미한 개인차 구현"

### 5. 📊 **QA 엔지니어** - Mike Johnson
- **역할**: 품질 보증과 테스트 자동화
- **집중 영역**: 엣지 케이스 처리, 일관성 검증
- **핵심 가치**: "100% 안정성과 예측 가능한 결과"

## 🚨 현재 상황 분석

### 🔴 Critical Issues (즉시 해결 필요)
1. **주능/주흉 레이더 차트 미표시**
   - 원인: saju-analysis 서비스(포트 4015) 미실행
   - 영향: 핵심 분석 기능 8, 9번 카테고리 사용 불가
   - 사용자 불만: "이전에 보였던 기능이 사라짐"

2. **100년 차트 주능/주흉 오버레이 누락**
   - 원인: HundredYearChart 컴포넌트에서 시각화 코드 제거됨
   - 영향: 길흉 시기를 한눈에 파악 불가
   - 기대: 금색(주능), 빨간색(주흉) 하이라이트 표시

### 🟡 Major Issues (중요도 높음)
3. **개인차 구현 미흡**
   - 현재: 박준수/정비제 평균점수 차이 0점
   - 목표: 20점 이상 차이
   - 영향: 개인별 맞춤 운세 신뢰도 하락

4. **용신 효과 약함**
   - 현재: +14~16점
   - 목표: +25점 이상
   - 영향: 사주학적 정확성 의문 제기

### ✅ 완료된 성과
- 정통 사주학 격국/용신 판별: 100% 정확
- 시스템 성능: S급 (0.2ms/건)
- 기본 차트 시스템: 정상 작동
- A급(82.3점) 품질 달성

## 🎯 작업 우선순위 매트릭스

```
긴급도 ↑
│ [1순위]                    [2순위]
│ • 주능/주흉 레이더 복원    • 100년 차트 오버레이
│ • saju-analysis 서비스     • 주능/주흉 시각화
│
│ [3순위]                    [4순위]
│ • 개인차 알고리즘          • UI/UX 개선
│ • 용신 효과 강화           • 문서화
│
└────────────────────────────────────→ 중요도
```

## 📝 Phase별 상세 작업 계획

### 🚀 Phase 1: 긴급 복원 (Day 1 - 4시간)

#### 작업 1-1: saju-analysis 서비스 복원 [David Park 담당]
```bash
# 실행 순서
1. cd packages/backend/services/saju-analysis
2. npm install
3. PORT=4015 npx ts-node --transpile-only src/index.ts
4. curl http://localhost:4015/api/saju/categories # 테스트
```

**체크리스트**:
- [ ] 서비스 디렉토리 존재 확인
- [ ] package.json 의존성 확인
- [ ] 포트 4015 가용성 확인
- [ ] 서비스 실행 및 로그 모니터링
- [ ] API 엔드포인트 응답 테스트

#### 작업 1-2: API 연동 검증 [Mike Johnson 담당]
```typescript
// 테스트 시나리오
1. GET /api/saju/categories 호출
2. 주능/주흉 데이터 구조 확인
3. transformApiDataToRadarCategories() 변환 검증
4. 레이더 차트 렌더링 확인
```

**성공 기준**:
- 8개 카테고리 모두 데이터 존재
- 주능/주흉 subcategories 최소 3개 이상
- 레이더 차트 정상 표시

### 🎨 Phase 2: 시각화 강화 (Day 1 - 4시간)

#### 작업 2-1: 주능/주흉 오버레이 구현 [Sarah Kim 담당]

**데이터 구조 확장**:
```typescript
export interface YearlyFortune {
  // 기존 필드...

  주능주흉: {
    type: '대길' | '길' | '평' | '흉' | '대흉';
    label: string;
    description: string;
    color: string;
    strength: number; // 0-100
    특수패턴?: string; // "천을귀인", "역마살" 등
  };

  길흉요소: {
    용신효과: number; // -30 ~ +30
    기신영향: number; // -30 ~ +30
    충극지수: number; // 0 ~ 100
    합화지수: number; // 0 ~ 100
    대운상생: boolean;
    세운상생: boolean;
  };
}
```

**시각화 구현**:
```tsx
// HundredYearChart 오버레이 레이어
<div className="overlay-container">
  {data.map(year => {
    const opacity = year.주능주흉.strength / 100;
    return (
      <div
        key={year.age}
        className={`fortune-overlay ${year.주능주흉.type}`}
        style={{
          left: `${(year.age / 100) * 100}%`,
          width: '1%',
          background: `linear-gradient(180deg,
            transparent,
            ${year.주능주흉.color}${Math.round(opacity * 255).toString(16)}
          )`
        }}
      >
        {year.주능주흉.type === '대길' && '⭐'}
        {year.주능주흉.type === '대흉' && '⚠️'}
      </div>
    );
  })}
</div>
```

**색상 시스템**:
```css
/* 주능/주흉 색상 팔레트 */
:root {
  --fortune-대길: #FFD700; /* 금색 */
  --fortune-길: #32CD32;   /* 연두색 */
  --fortune-평: #808080;   /* 회색 */
  --fortune-흉: #FF6347;   /* 토마토색 */
  --fortune-대흉: #8B0000; /* 진한 빨강 */
}

/* 애니메이션 효과 */
.fortune-overlay.대길 {
  animation: golden-glow 2s ease-in-out infinite;
}

.fortune-overlay.대흉 {
  animation: danger-pulse 1.5s ease-in-out infinite;
}

@keyframes golden-glow {
  0%, 100% { box-shadow: 0 0 10px var(--fortune-대길); }
  50% { box-shadow: 0 0 30px var(--fortune-대길); }
}

@keyframes danger-pulse {
  0%, 100% { opacity: 0.8; }
  50% { opacity: 1; background-color: rgba(139, 0, 0, 0.3); }
}
```

### 🔬 Phase 3: 알고리즘 고도화 (Day 2 - 8시간)

#### 작업 3-1: 개인차 강화 알고리즘 [Master Lee + Dr. Chen 협업]

**격국별 기본점수 차별화**:
```typescript
class EnhancedSajuCalculator {
  private static getBaseScoreByGyeokguk(격국: string, 일간: string): number {
    const 격국점수맵 = {
      '신강격': {
        기본: 70,
        변동폭: 20,
        특성: '안정적이고 지속적인 운'
      },
      '신약격': {
        기본: 50,
        변동폭: 30,
        특성: '변화무쌍하고 극적인 운'
      },
      '종격': {
        기본: 60,
        변동폭: 25,
        특성: '특정 분야 집중 운'
      },
      '특수격': {
        기본: 65,
        변동폭: 35,
        특성: '예측 불가능한 대박 운'
      }
    };

    const 격국데이터 = 격국점수맵[격국] || 격국점수맵['신약격'];
    const 일간보정 = this.get일간보정값(일간);

    return 격국데이터.기본 + 일간보정;
  }

  private static get일간보정값(일간: string): number {
    // 일간의 특성에 따른 개인차 보정
    const 일간특성 = {
      '갑': 5,  // 리더십 보정
      '을': 3,  // 유연성 보정
      '병': 7,  // 열정 보정
      '정': 4,  // 섬세함 보정
      '무': 6,  // 안정성 보정
      '기': 2,  // 변화 보정
      '경': 8,  // 결단력 보정
      '신': 3,  // 예리함 보정
      '임': 4,  // 지혜 보정
      '계': 5   // 통찰력 보정
    };

    return 일간특성[일간] || 0;
  }
}
```

**용신 효과 극대화**:
```typescript
private static calculate용신효과강화(
  연도데이터: any,
  용신: YongSinAnalysis,
  나이: number
): number {
  const 기본효과 = 연도데이터.용신효과 || 0;

  // 나이별 용신 중요도 가중치
  let 나이가중치 = 1.0;
  if (나이 >= 20 && 나이 <= 40) {
    나이가중치 = 1.5; // 청년기 용신 중요
  } else if (나이 >= 40 && 나이 <= 60) {
    나이가중치 = 1.3; // 중년기 용신 중요
  } else if (나이 >= 60) {
    나이가중치 = 1.1; // 노년기 안정 추구
  }

  // 용신 일치도에 따른 보정
  const 용신일치도 = this.calculate용신일치도(연도데이터, 용신);
  const 일치도보정 = 용신일치도 > 0.8 ? 30 :
                    용신일치도 > 0.6 ? 20 :
                    용신일치도 > 0.4 ? 10 : 0;

  // 기신 상쇄 효과
  const 기신영향 = this.calculate기신영향(연도데이터, 용신);
  const 기신감소 = 기신영향 > 0.8 ? -25 :
                  기신영향 > 0.6 ? -15 :
                  기신영향 > 0.4 ? -8 : 0;

  return (기본효과 * 나이가중치) + 일치도보정 + 기신감소;
}
```

### 📊 Phase 4: 테스트 및 검증 (Day 3 - 4시간)

#### 작업 4-1: A/B 테스트 구현 [QA Team 전체]

**테스트 시나리오**:
```typescript
const 테스트케이스 = [
  {
    이름: '박준수',
    사주: '신해기해병오경인',
    예상격국: '신약격',
    예상용신: ['화', '목'],
    최소점수차이: 20
  },
  {
    이름: '정비제',
    사주: '병진정유신미계사',
    예상격국: '신강격',
    예상용신: ['목', '수'],
    최소점수차이: 20
  },
  {
    이름: '테스트유저1',
    사주: '갑자을축병인정묘',
    예상격국: '종격',
    예상용신: ['금', '토'],
    최소점수차이: 15
  }
];

// 자동화 테스트
테스트케이스.forEach(tc => {
  const result = calculateLifetimeFortune(tc.사주);

  // 검증 항목
  expect(result.격국).toBe(tc.예상격국);
  expect(result.용신).toContain(tc.예상용신);
  expect(result.평균점수차이).toBeGreaterThan(tc.최소점수차이);
  expect(result.용신효과평균).toBeGreaterThan(20);
});
```

#### 작업 4-2: 사용자 피드백 시뮬레이션

**UX 테스트 체크리스트**:
- [ ] 주능 시기가 금색으로 명확히 표시되는가?
- [ ] 주흉 시기가 빨간색으로 경고되는가?
- [ ] 개인별 차트가 명확히 다른가?
- [ ] 용신 효과가 체감되는가?
- [ ] 레이더 차트 8개 카테고리가 모두 표시되는가?

### 🚢 Phase 5: 배포 준비 (Day 3 - 4시간)

#### 작업 5-1: 서비스 통합 테스트

**통합 체크리스트**:
```bash
# 1. 모든 서비스 실행
PORT=4000 npm run dev         # 프론트엔드
PORT=4012 npm start           # calendar service
PORT=4015 npm start           # saju-analysis service

# 2. 헬스체크
curl http://localhost:4000    # 프론트엔드
curl http://localhost:4012/health  # 캘린더
curl http://localhost:4015/health  # 사주분석

# 3. 통합 시나리오 테스트
- 사용자 등록 → 생년월일 입력 → 사주 분석 →
  100년 차트 확인 → 레이더 차트 확인 → 주능/주흉 확인
```

## 📈 예상 성과 지표

### Before (현재)
| 지표 | 현재값 | 문제점 |
|-----|--------|--------|
| 개인차 점수 | 0점 | 차별화 없음 |
| 용신 효과 | +15점 | 효과 미미 |
| 주능/주흉 표시 | 0% | 미표시 |
| 사용자 만족도 | 65% | 개선 필요 |
| 시스템 품질 | 82.3점 (A급) | 우수 |

### After (목표)
| 지표 | 목표값 | 개선률 |
|-----|--------|--------|
| 개인차 점수 | 25점 이상 | ∞% |
| 용신 효과 | +30점 | 100% ↑ |
| 주능/주흉 표시 | 100% | 완전 복원 |
| 사용자 만족도 | 90% | 38% ↑ |
| 시스템 품질 | 92점 (S급) | 12% ↑ |

## ⚠️ 리스크 관리

### 잠재 리스크 및 대응 방안

| 리스크 | 발생 확률 | 영향도 | 대응 방안 |
|--------|----------|--------|-----------|
| saju-analysis 서비스 복원 실패 | 낮음 | 치명적 | Mock 데이터로 임시 대응 |
| 개인차 알고리즘 과도한 차이 | 중간 | 높음 | 단계적 적용 (10점→20점→25점) |
| 용신 효과 과대 적용 | 낮음 | 중간 | A/B 테스트로 검증 |
| 성능 저하 | 낮음 | 높음 | 캐싱 전략 도입 |

## 🎯 최종 체크리스트

### Day 1 완료 기준
- [ ] saju-analysis 서비스 정상 실행 (포트 4015)
- [ ] 레이더 차트 8개 카테고리 모두 표시
- [ ] 100년 차트 주능/주흉 오버레이 구현
- [ ] 시각적 차별화 완성 (금색/빨간색)

### Day 2 완료 기준
- [ ] 개인차 알고리즘 구현 완료
- [ ] 박준수/정비제 평균 20점 이상 차이
- [ ] 용신 효과 +25점 이상 달성
- [ ] 격국별 기본점수 차별화 적용

### Day 3 완료 기준
- [ ] 전체 통합 테스트 통과
- [ ] 성능 벤치마크 S급 유지
- [ ] 사용자 시뮬레이션 90% 만족도
- [ ] 배포 준비 완료

## 📝 작업 완료 보고 템플릿

```markdown
## 작업 완료 보고서

### 구현된 기능
1. ✅ 주능/주흉 레이더 차트 복원
2. ✅ 100년 차트 오버레이 구현
3. ✅ 개인차 알고리즘 강화 (평균 25점 차이)
4. ✅ 용신 효과 극대화 (+30점)

### 성과 지표
- 시스템 품질: 82.3점 → 92점 (S급 달성)
- 사용자 만족도: 65% → 90%
- 개인차 구현도: 0점 → 25점

### 테스트 결과
- 단위 테스트: 100% 통과
- 통합 테스트: 100% 통과
- 성능 테스트: 0.2ms/건 유지

### 스크린샷
[주능/주흉 차트 이미지]
[개인별 차이 비교 이미지]

### 다음 단계 제안
1. 음력 달력 연동
2. AI 기반 운세 해석
3. 소셜 공유 기능
```

## 🚀 즉시 실행 명령어

```bash
# 1단계: 백엔드 서비스 실행
cd packages/backend/services/saju-analysis
PORT=4015 npx ts-node --transpile-only src/index.ts

# 2단계: 프론트엔드 실행
cd packages/web
PORT=4000 npm run dev

# 3단계: 브라우저 테스트
start http://localhost:4000/unified-saju-analysis

# 4단계: API 테스트
curl http://localhost:4015/api/saju/categories
```

---

**작성일**: 2025년 9월 21일
**작성자**: PM & 전문가 페르소나 팀
**승인자**: Project Owner
**상태**: 🟢 실행 준비 완료
**우선순위**: 🔴 최우선 (Critical)

**특별 지시사항**:
1. 모든 작업은 포트 4000 기준으로 진행
2. TodoWrite 도구로 실시간 진행 상황 추적
3. 각 Phase 완료 시 Git 커밋 필수
4. 테스트 없이 다음 단계 진행 금지

---

*"한 눈에 보이는 운세, 과학적으로 검증된 사주학"*
*- 운명나침반 개발팀 -*