# 📋 일기장 추가 기능 및 버그 수정 작업지시서

## 🐛 버그 수정 사항

### 1. ❌ 월간 뷰 일기 호버 문제
- **현재 문제**: 월간 캘린더에서 일기 아이콘에 마우스 호버 시 여전히 일기 내용이 표시됨
- **원인 분석**: 
  - DiaryIndicator의 title 속성은 제거했으나
  - MonthView에서 별도의 tooltip이나 hover 로직이 있을 가능성
- **해결 방안**:
  - MonthView.tsx에서 일기 관련 hover/title 완전 제거
  - 일기 내용을 표시하는 모든 코드 삭제
  - 클릭 시에만 DiaryBookModal이 열리도록 확인

### 2. 👁️ 일간 뷰 표시 문제
- **현재 문제**: 일간 뷰가 보이지 않음
- **확인 필요 사항**:
  - DayViewEnhanced 컴포넌트 렌더링 확인
  - CalendarPage에서 라우팅 문제 확인
  - 콘솔 에러 확인
- **해결 방안**:
  - 에러 로그 확인 및 수정
  - 컴포넌트 import/export 확인
  - viewMode 상태 전환 로직 검증

## 🎯 신규 기능 개발

### 3. 📷 일기 이미지 업로드 기능
- **기능 요구사항**:
  - 일기에 이미지를 첨부할 수 있는 기능
  - 하루 최대 3장까지 업로드 가능
  - 이미지 미리보기 제공
  - 이미지 삭제 기능

#### 구현 세부사항:

##### 3.1 프론트엔드 (DiaryBookModal)
```tsx
// 추가할 state
const [images, setImages] = useState<string[]>([])
const [isUploading, setIsUploading] = useState(false)

// 이미지 업로드 핸들러
const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
  const files = e.target.files
  if (!files || files.length === 0) return
  
  // 최대 3장 제한
  if (images.length + files.length > 3) {
    alert('최대 3장까지 업로드 가능합니다')
    return
  }
  
  // Base64 변환 및 저장
  for (const file of files) {
    const reader = new FileReader()
    reader.onloadend = () => {
      setImages(prev => [...prev, reader.result as string])
    }
    reader.readAsDataURL(file)
  }
}
```

##### 3.2 UI 디자인
- **업로드 버튼**: 카메라 아이콘 + "사진 추가" 텍스트
- **이미지 표시**: 
  - 썸네일 형태로 하단에 표시
  - 클릭 시 확대 보기
  - X 버튼으로 삭제 가능
- **위치**: 오늘 일기 페이지 하단, 글자 수 표시 위

##### 3.3 백엔드 (Diary Service)
```typescript
// diary.entity 수정
interface DiaryEntry {
  id: string
  date: string
  content: string
  mood?: string
  weather?: string
  tags?: string[]
  images?: string[] // 새로 추가
  created_at: Date
  updated_at: Date
}
```

##### 3.4 데이터베이스 스키마
```sql
-- 기존 diaries 테이블에 컬럼 추가
ALTER TABLE diaries ADD COLUMN images TEXT;
-- JSON 배열로 저장 (Base64 이미지 데이터)
```

## 🎨 UI/UX 개선사항

### 이미지 업로드 UI 스타일
```tsx
// 업로드 버튼
<label className="flex items-center gap-2 px-3 py-2 
                 bg-amber-100 dark:bg-slate-700 
                 hover:bg-amber-200 dark:hover:bg-slate-600 
                 rounded-lg cursor-pointer transition-colors">
  <Camera className="w-5 h-5" />
  <span>사진 추가</span>
  <input 
    type="file" 
    accept="image/*" 
    multiple 
    className="hidden"
    onChange={handleImageUpload}
  />
</label>

// 이미지 썸네일
<div className="grid grid-cols-3 gap-2 mt-3">
  {images.map((img, idx) => (
    <div key={idx} className="relative group">
      <img 
        src={img} 
        className="w-full h-24 object-cover rounded-lg"
        onClick={() => openImageViewer(img)}
      />
      <button 
        onClick={() => removeImage(idx)}
        className="absolute top-1 right-1 
                   bg-red-500 text-white 
                   rounded-full w-5 h-5 
                   opacity-0 group-hover:opacity-100 
                   transition-opacity"
      >
        ×
      </button>
    </div>
  ))}
</div>
```

## 📝 테스트 항목

### 버그 수정 확인
- [ ] 월간 뷰에서 일기 호버 시 내용 표시 안 됨
- [ ] 일기 아이콘 클릭 시에만 모달 열림
- [ ] 일간 뷰가 정상적으로 표시됨
- [ ] 일간 뷰에서 모든 기능 정상 작동

### 이미지 업로드 기능
- [ ] 이미지 선택 및 업로드 가능
- [ ] 최대 3장 제한 작동
- [ ] 이미지 미리보기 표시
- [ ] 이미지 삭제 기능
- [ ] 이미지와 함께 일기 저장
- [ ] 저장된 이미지 다시 불러오기

## 🔧 구현 우선순위
1. **즉시**: 월간 뷰 호버 버그 수정
2. **높음**: 일간 뷰 표시 문제 해결  
3. **중간**: 이미지 업로드 기능 개발

## 💡 추가 고려사항
- 이미지 압축 (용량 최적화)
- 이미지 로딩 시 스켈레톤 UI
- 드래그 앤 드롭 업로드 지원
- 이미지 순서 변경 기능